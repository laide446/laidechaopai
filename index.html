<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ´ é©¬å¹´åˆ®åˆ®ä¹æŠ½å¥–ç³»ç»Ÿ - 20å…ƒ1æ¬¡ 10æ¬¡å¿…ä¸­é‹</title>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ç¡®ä¿Supabase SDKåŠ è½½å®Œæˆ
        window.createClient = window.supabase.createClient;
    </script>
    <!-- è…¾è®¯äº‘COS SDK -->
    <script src="https://cdn.jsdelivr.net/npm/cos-js-sdk-v5@1.4.14/dist/cos-js-sdk-v5.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: "å¾®è½¯é›…é»‘", sans-serif; background: linear-gradient(135deg, #fef6e7 0%, #fff9e8 100%); color: #333; }
        
        /* é©¬å¹´èƒŒæ™¯å…ƒç´  */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(217, 33, 33, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 30%, rgba(255, 209, 102, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 50% 80%, rgba(217, 33, 33, 0.1) 0%, transparent 20%);
            z-index: -1;
        }
        
        .container {
            max-width: 500px;
            margin: 20px auto;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        /* é©¬å¹´è£…é¥°å…ƒç´  */
        .container::before {
            content: 'ğŸ´';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 80px;
            opacity: 0.1;
            z-index: 0;
        }
        
        .container::after {
            content: 'ğŸŠ';
            position: absolute;
            bottom: -20px;
            left: -20px;
            font-size: 80px;
            opacity: 0.1;
            z-index: 0;
        }
        
        /* å†…å®¹å±‚ */
        .container > * {
            position: relative;
            z-index: 1;
        }
        h1 {
            text-align: center;
            color: #d92121;
            font-size: 32px;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(217, 33, 33, 0.1);
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 18px;
        }
        
        .code-input {
            width: 100%;
            padding: 18px;
            border: 3px solid #ffd166;
            border-radius: 12px;
            font-size: 18px;
            margin-bottom: 12px;
            text-align: center;
            transition: all 0.3s ease;
            background: #fff9f0;
        }
        
        .code-input:focus {
            outline: none;
            border-color: #d92121;
            box-shadow: 0 0 15px rgba(217, 33, 33, 0.2);
        }
        
        .code-input.error {
            border-color: #dc3545;
            background: #fff5f5;
        }
        
        .error-tip {
            color: #dc3545;
            font-size: 14px;
            text-align: center;
            margin-bottom: 20px;
            animation: shake 0.5s ease-in-out;
        }
        
        .error-tip.hidden {
            display: none;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #d92121 0%, #b31212 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(217, 33, 33, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s ease;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #b31212 0%, #990e0e 100%);
            box-shadow: 0 6px 20px rgba(217, 33, 33, 0.4);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-admin {
            width: 31%;
            padding: 14px;
            font-size: 16px;
            margin: 5px 1%;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333 0%, #a71e2a 100%);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #138496 0%, #0f6674 100%);
        }
        
        .user-actions {
            margin: 15px 0;
            display: flex;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            height: auto;
            width: auto;
        }
        
        .user-prize-list div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: white;
            border-radius: 5px;
            font-size: 12px;
        }
        
        .user-prize-list div:last-child {
            margin-bottom: 0;
        }
        
        /* åˆ®å¥–åŒº - ç®€åŒ–ä¸”ç¨³å®šçš„ç‰ˆæœ¬ */
        .scratch-container {
            width: 100%;
            height: 350px;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin: 25px 0;
            touch-action: none;
            border: 5px solid #ffd166;
        }
        
        #scratchCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }
        
        #scratchCanvas::before {
            content: 'åˆ®å¼€å›¾å±‚ å¥½è¿å°±åˆ°';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            font-weight: bold;
            color: #000000;
            text-align: center;
            white-space: nowrap;
            z-index: 1;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }
        
        #scratchResult {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            font-weight: bold;
            color: #000000;
            text-align: center;
            z-index: 1;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .count-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #ffd166;
        }
        
        .count-tip {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .count-number {
            font-size: 36px;
            font-weight: bold;
            color: #d92121;
            text-shadow: 2px 2px 4px rgba(217, 33, 33, 0.1);
        }
        
        /* ä¸­å¥–è®°å½• */
        .record-container {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #ffd166;
        }
        
        .record-title {
            font-size: 20px;
            font-weight: bold;
            color: #d92121;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .record-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .record-item {
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            font-size: 14px;
            line-height: 1.4;
        }
        
        /* æ»šåŠ¨æ’­æŠ¥ */
        .scroll-ticker {
            width: 100%;
            height: 40px;
            overflow: hidden;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .ticker-content {
            display: flex;
            align-items: center;
            height: 100%;
            position: absolute;
            white-space: nowrap;
        }
        
        .ticker-item {
            margin: 0 30px;
            font-size: 14px;
            color: #856404;
            font-weight: bold;
        }
        
        /* è§„åˆ™åŒºåŸŸ */
        .rules {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #17a2b8;
        }
        
        .rules h3 {
            color: #17a2b8;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .rules ul {
            list-style: none;
            line-height: 1.6;
        }
        
        .rules li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .rules li::before {
            content: 'â€¢';
            color: #17a2b8;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        /* ç®¡ç†å‘˜é¡µé¢ */
        .admin-page {
            display: none;
        }
        
        .admin-login {
            text-align: center;
            padding: 40px 20px;
        }
        
        .admin-login h3 {
            color: #d92121;
            margin-bottom: 30px;
        }
        
        .admin-login input {
            width: 80%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #ffd166;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .admin-main {
            display: none;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px dashed #ffd166;
        }
        
        .admin-title {
            color: #d92121;
            font-size: 24px;
            font-weight: bold;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            text-align: center;
            border: 2px dashed #17a2b8;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #17a2b8;
        }
        
        .search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .search-container input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ffd166;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .user-list {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .user-card {
            padding: 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 2px solid #f8f9fa;
        }
        
        .user-card h4 {
            color: #d92121;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-card h4 span {
            font-size: 14px;
            font-weight: normal;
            color: #28a745;
        }
        
        .user-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .user-info div {
            font-size: 14px;
        }
        
        .user-info div span {
            font-weight: bold;
            color: #17a2b8;
        }
        
        .prize-detail {
            margin-top: 15px;
        }
        
        .prize-detail h5 {
            color: #666;
            margin-bottom: 10px;
        }
        
        .user-prize-list {
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 12px;
            line-height: 1.4;
        }
        
        /* æç¤ºæ¨¡æ€æ¡† */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 80%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .modal h3 {
            color: #d92121;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .modal p {
            margin-bottom: 30px;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .modal .btn {
            width: 120px;
            height: 40px;
            background: #d92121;
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal .btn:hover {
            background: #c8102e;
            transform: translateY(-2px);
        }
        
        /* éšè—ç±» */
        .hidden {
            display: none !important;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 30px;
            color: #666;
        }
        
        /* ç®¡ç†æŒ‰é’® */
        .admin-enter {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d92121 0%, #b31212 100%);
            color: white;
            border: none;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(217, 33, 33, 0.4);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .admin-enter:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(217, 33, 33, 0.5);
        }
        
        /* è®¤è¯ç›¸å…³æ ·å¼ */
        .auth-form {
            margin: 20px 0;
        }
        
        .auth-form h3 {
            text-align: center;
            color: #d92121;
            margin-bottom: 10px;
        }
        
        .auth-tip {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .auth-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .auth-actions .btn {
            flex: 1;
        }
        
        .user-info-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        #currentUser {
            font-weight: bold;
            color: #17a2b8;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 16px;
            }
            
            .btn {
                padding: 15px;
                font-size: 18px;
            }
            
            .scratch-container {
                height: 250px;
            }
            
            #scratchResult {
                font-size: 24px;
            }
            
            .count-number {
                font-size: 28px;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .auth-actions {
                flex-direction: column;
            }
            
            /* éªŒè¯ç å®¹å™¨å“åº”å¼è°ƒæ•´ */
            .auth-form div[style*="display: flex; gap: 10px; align-items: center;"] {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .auth-form div[style*="display: flex; gap: 10px; align-items: center;"] .captcha-img {
                width: 100%;
                height: 50px;
            }
            
            /* ç®¡ç†å‘˜æ“ä½œæŒ‰é’®å“åº”å¼è°ƒæ•´ */
            #adminMain div[style*="display: flex; gap: 10px; margin-top: 20px;"] {
                flex-wrap: wrap;
            }
            
            #adminMain div[style*="display: flex; gap: 10px; margin-top: 20px;"] .btn {
            flex: 1 1 calc(50% - 5px);
            min-width: 120px;
        }
        }
        
        /* ä¸­å¥–ä¿¡æ¯åŠ¨ç”» */
        @keyframes prizeAppear {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.1) translateY(-5px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- ç™»å½•/æ³¨å†Œé¡µé¢ -->
    <div id="authPage" class="container">
        <h1>ğŸ´ é©¬å¹´åˆ®åˆ®ä¹æŠ½å¥–</h1>
        <p class="subtitle">20å…ƒ1æ¬¡ | 10æ¬¡å¿…ä¸­é‹ | æ¬¡æ¬¡æœ‰å¥– æ— ç©ºå¥–</p>
        
        <!-- ç™»å½•è¡¨å• -->
        <div id="loginForm" class="auth-form">
            <h3>ç”¨æˆ·ç™»å½•</h3>
            <p class="auth-tip">è¯·ä½¿ç”¨æ‚¨çš„å¾®ä¿¡å·ç™»å½•</p>
            <input type="text" id="username" class="code-input" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
            <input type="password" id="password" class="code-input" placeholder="è¯·è¾“å…¥å¯†ç ">
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" id="loginCaptcha" class="code-input" placeholder="è¯·è¾“å…¥éªŒè¯ç " style="flex: 1;">
                <div id="loginCaptchaImg" class="captcha-img" style="width: 100px; height: 40px; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 6px;">ç‚¹å‡»åˆ·æ–°</div>
            </div>
            <div class="auth-actions">
                <button id="userLoginBtn" class="btn">ç™»å½•</button>
                <button id="showRegisterBtn" class="btn btn-info">æ–°ç”¨æˆ·æ³¨å†Œ</button>
            </div>

        </div>
        
        <!-- æ³¨å†Œè¡¨å• -->
        <div id="registerForm" class="auth-form hidden">
            <h3>ç”¨æˆ·æ³¨å†Œ</h3>
            <p class="auth-tip">è¯·ä½¿ç”¨æ‚¨çš„å¾®ä¿¡å·æ³¨å†Œè´¦å·</p>
            <input type="text" id="regUsername" class="code-input" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
            <input type="password" id="regPassword" class="code-input" placeholder="è¯·è®¾ç½®å¯†ç ">
            <input type="password" id="regConfirmPassword" class="code-input" placeholder="è¯·ç¡®è®¤å¯†ç ">
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" id="regCaptcha" class="code-input" placeholder="è¯·è¾“å…¥éªŒè¯ç " style="flex: 1;">
                <div id="regCaptchaImg" class="captcha-img" style="width: 100px; height: 40px; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 6px;">ç‚¹å‡»åˆ·æ–°</div>
            </div>
            <div class="auth-actions">
                <button id="registerBtn" class="btn">æ³¨å†Œ</button>
                <button id="showLoginBtn" class="btn btn-info">è¿”å›ç™»å½•</button>
            </div>
        </div>
        
        <div id="authError" class="error-tip hidden"></div>
    </div>
    
    <!-- ç”¨æˆ·é¡µé¢ -->
    <div id="userPage" class="container hidden">
        <h1>ğŸ´ é©¬å¹´åˆ®åˆ®ä¹æŠ½å¥–</h1>
        <p class="subtitle">20å…ƒ1æ¬¡ | 10æ¬¡å¿…ä¸­é‹ | æ¬¡æ¬¡æœ‰å¥– æ— ç©ºå¥–</p>
        
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div class="user-info-bar">
            <span id="currentUser">æ¬¢è¿ï¼Œç”¨æˆ·</span>
            <div style="display: flex; gap: 10px;">
                <button id="notificationBtn" class="btn btn-sm btn-info">é€šçŸ¥</button>
                <button id="logoutBtn" class="btn btn-sm">é€€å‡ºç™»å½•</button>
            </div>
        </div>
        
        <!-- æ»šåŠ¨æ’­æŠ¥ -->
        <div class="scroll-ticker">
            <div id="tickerContent" class="ticker-content"></div>
        </div>
        
        <!-- å…‘æ¢ç è¾“å…¥ -->
        <input type="text" id="exchangeCode" class="code-input" placeholder="è¯·è¾“å…¥å…‘æ¢ç ">
        <div id="codeError" class="error-tip">å…‘æ¢ç æ— æ•ˆ</div>
        <button id="bindCodeBtn" class="btn">ç»‘å®šå…‘æ¢ç </button>
        
        <!-- å‰©ä½™æ¬¡æ•° -->
        <div id="countTip" class="count-container hidden">
            <div class="count-tip">å‰©ä½™æŠ½å¥–æ¬¡æ•°</div>
            <div class="count-number"><span id="leftCountSpan">0</span> æ¬¡</div>
        </div>
        
        <!-- åˆ®å¥–åŒº -->
        <div id="scratchContainer" class="scratch-container hidden">
            <div id="scratchResult">æ»‘åŠ¨åˆ®å¼€<br>æ¬¡æ¬¡æœ‰å¥–</div>
            <canvas id="scratchCanvas"></canvas>
        </div>
        
        <!-- ä¸­å¥–è®°å½• -->
        <div id="recordContainer" class="record-container hidden">
            <div class="record-title">ä¸­å¥–è®°å½•</div>
            <div id="recordList" class="record-list"></div>
        </div>
        
        <!-- æ´»åŠ¨è§„åˆ™ -->
        <div class="rules">
            <h3>æ´»åŠ¨è§„åˆ™</h3>
            <ul>
                <li>20å…ƒ1æ¬¡æŠ½å¥–ï¼Œå…‘æ¢ç ç”±å•†å®¶ä¸“å±æä¾›ï¼Œéå•†å®¶å‘æ”¾å‡ä¸ºæ— æ•ˆç </li>
                <li>ç´¯è®¡æŠ½æ»¡10æ¬¡ï¼Œç›´æ¥è·å¾—<strong>299å…ƒé‹å­ä¸€åŒï¼ˆæ¬¾å¼å¯è‡ªé€‰ï¼‰</strong>ï¼Œä¸­é€”æ¬¡æ¬¡æœ‰å¥–æ— ç©ºå¥–</li>
                <li>æ‰€æœ‰å¥–é¡¹å‡<strong>30æ—¥å†…æœ‰æ•ˆ</strong>ï¼Œè”ç³»å•†å®¶æ ¸é”€å…‘æ¢</li>
                <li>å¯å¤šæ¬¡ç»‘å®šå…‘æ¢ç ï¼Œæ¬¡æ•°ç´¯åŠ ï¼Œç»‘å®šè®¾å¤‡ä¸å¯è½¬èµ </li>
                <li>æ¯ä¸ªå…‘æ¢ç åªå¯ä½¿ç”¨ä¸€æ¬¡ï¼Œé‡å¤ä½¿ç”¨æ— æ•ˆ</li>
                <li><strong>ä»£é‡‘åˆ¸æ¯æ¬¡ä¸‹å•åªå¯ä½¿ç”¨ä¸€å¼ </strong></li>
            </ul>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜é¡µé¢ -->
    <div id="adminPage" class="container admin-page">
        <!-- ç™»å½• -->
        <div id="adminLogin" class="admin-login">
            <h3>ç®¡ç†å‘˜ç™»å½•</h3>
            <input type="password" id="adminPwd" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <div id="adminPwdErrorTip" class="error-tip">å¯†ç é”™è¯¯</div>
            <button id="adminLoginBtn" class="btn">ç™»å½•</button>
        </div>
        
        <!-- ç®¡ç†åå° -->
        <div id="adminMain" class="admin-main">
            <div class="admin-header">
                <h2 class="admin-title">ğŸ´ é©¬å¹´åˆ®åˆ®ä¹ç®¡ç†åå°</h2>
                <button id="backBtn" class="btn btn-info">è¿”å›ç”¨æˆ·é¡µ</button>
            </div>
            
            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                    <div id="totalUserNum" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ€»æŠ½å¥–æ¬¡æ•°</div>
                    <div id="totalDrawNum" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ä¸­é‹ç”¨æˆ·æ•°</div>
                    <div id="totalShoeUser" class="stat-value">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">å·²ç”¨å…‘æ¢ç </div>
                    <div id="totalUsedCode" class="stat-value">0</div>
                </div>
            </div>
            
            <!-- æœç´¢ -->
            <div class="search-container">
                <input type="text" id="searchUserInput" placeholder="æœç´¢ç”¨æˆ·æˆ–å¥–å“">
                <button id="searchBtn" class="btn">æœç´¢</button>
            </div>
            
            <!-- ç”¨æˆ·åˆ—è¡¨ -->
            <div id="userList" class="user-list">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
            
            <!-- æ“ä½œæŒ‰é’® -->
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="refreshDataBtn" class="btn btn-info">åˆ·æ–°æ•°æ®</button>
                <button id="clearAllDataBtn" class="btn btn-danger">æ¸…ç©ºæ•°æ®</button>
                <button id="exportBtn" class="btn">å¯¼å‡ºExcel</button>
                <button id="codeManageBtn" class="btn btn-info">å…‘æ¢ç ç®¡ç†</button>
                <button id="addPrizeBtn" class="btn btn-success">æ·»åŠ ä¸­å¥–è®°å½•</button>
            </div>
        </div>
    </div>
    
    <!-- æç¤ºæ¨¡æ€æ¡† -->
    <div id="tipModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">æç¤º</h3>
            <p id="modalContent">æ“ä½œæˆåŠŸ</p>
            <button id="modalClose" class="btn">ç¡®å®š</button>
        </div>
    </div>
    
    <!-- ä¸­å¥–æ¦‚ç‡é…ç½®æ¨¡æ€æ¡† -->
    <div id="probabilityModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3>ä¸­å¥–æ¦‚ç‡é…ç½®</h3>
            <div style="margin-bottom: 20px;">
                <p style="margin-bottom: 15px; color: #666;">è¯·è°ƒæ•´å„å¥–é¡¹çš„ä¸­å¥–æ¦‚ç‡ï¼ˆæ€»å’Œåº”æ¥è¿‘100%ï¼‰ï¼š</p>
                <div id="probabilityForm" style="display: grid; gap: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>8.8å…ƒç°é‡‘çº¢åŒ…</label>
                        <input type="number" id="prob-cash88" min="0" max="100" step="1" value="10" style="width: 80px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                        <span>%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>6.6å…ƒç°é‡‘çº¢åŒ…</label>
                        <input type="number" id="prob-cash66" min="0" max="100" step="1" value="20" style="width: 80px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                        <span>%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>20å…ƒä»£é‡‘åˆ¸</label>
                        <input type="number" id="prob-coupon20" min="0" max="100" step="1" value="30" style="width: 80px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                        <span>%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>25å…ƒä»£é‡‘åˆ¸</label>
                        <input type="number" id="prob-coupon25" min="0" max="100" step="1" value="30" style="width: 80px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                        <span>%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>ä»·å€¼299å…ƒé‹å­</label>
                        <input type="number" id="prob-shoe" min="0" max="100" step="1" value="10" style="width: 80px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                        <span>%</span>
                    </div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label style="font-weight: bold;">æ€»æ¦‚ç‡</label>
                        <span id="totalProbability" style="font-weight: bold; color: #17a2b8;">100%</span>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="probabilityCancel" class="btn btn-info">å–æ¶ˆ</button>
                <button id="probabilitySave" class="btn">ä¿å­˜é…ç½®</button>
            </div>
        </div>
    </div>
    
    <!-- å…‘æ¢ç ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="codeManageModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3>å…‘æ¢ç ç®¡ç†</h3>
            <div style="margin-bottom: 20px;">
                <h4 style="margin-bottom: 15px;">ç”Ÿæˆå…‘æ¢ç </h4>
                <div style="display: grid; gap: 15px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>æŠ½å¥–æ¬¡æ•°</label>
                        <input type="number" id="codeDrawTimes" min="1" max="100" step="1" value="5" style="width: 120px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label>ç”Ÿæˆæ•°é‡</label>
                        <input type="number" id="codeGenerateCount" min="1" max="100" step="1" value="1" style="width: 120px; padding: 8px; border: 2px solid #ffd166; border-radius: 6px;">
                    </div>
                </div>
                <button id="generateCodeBtn" class="btn" style="width: 100%; margin-bottom: 20px;">ç”Ÿæˆå…‘æ¢ç </button>
                
                <h4 style="margin-bottom: 15px;">ç”Ÿæˆç»“æœ</h4>
                <div id="codeResult" style="border: 2px solid #ffd166; border-radius: 8px; padding: 15px; min-height: 100px; background-color: #fffbeb; font-family: monospace; white-space: pre-wrap;">
                    ç”Ÿæˆçš„å…‘æ¢ç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>
                <button id="copyCodesBtn" class="btn btn-info" style="width: 100%; margin-top: 10px;">å¤åˆ¶å…‘æ¢ç </button>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="codeManageCancel" class="btn btn-info">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- å¯†ç é‡ç½®æ¨¡æ€æ¡† -->
    <div id="resetPasswordModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h3>é‡ç½®å¯†ç </h3>
            <div style="margin-bottom: 20px;">
                <p style="margin-bottom: 15px; color: #666;">è¯·è¾“å…¥æ‚¨çš„å¾®ä¿¡å·å’Œæ–°å¯†ç ï¼š</p>
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px;">å¾®ä¿¡å·</label>
                        <input type="text" id="resetUsername" class="code-input" placeholder="è¯·è¾“å…¥å¾®ä¿¡å·">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px;">æ–°å¯†ç </label>
                        <input type="password" id="resetPassword" class="code-input" placeholder="è¯·è®¾ç½®æ–°å¯†ç ">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px;">ç¡®è®¤æ–°å¯†ç </label>
                        <input type="password" id="resetConfirmPassword" class="code-input" placeholder="è¯·ç¡®è®¤æ–°å¯†ç ">
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="resetPasswordCancel" class="btn btn-info">å–æ¶ˆ</button>
                <button id="resetPasswordSubmit" class="btn">é‡ç½®å¯†ç </button>
            </div>
        </div>
    </div>
    
    <!-- é€šçŸ¥ä¸­å¿ƒæ¨¡æ€æ¡† -->
    <div id="notificationModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>é€šçŸ¥ä¸­å¿ƒ</h3>
            <div id="notificationList" style="margin-bottom: 20px; max-height: 400px; overflow-y: auto;">
                <div class="loading">åŠ è½½é€šçŸ¥ä¸­...</div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="notificationMarkAllRead" class="btn btn-info">æ ‡è®°å…¨éƒ¨å·²è¯»</button>
                <button id="notificationClose" class="btn">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ ä¸­å¥–è®°å½•æ¨¡æ€æ¡† -->
    <div id="addPrizeModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3>æ·»åŠ ä¸­å¥–è®°å½•</h3>
            <div style="margin-bottom: 20px;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px;">ç”¨æˆ·å</label>
                        <input type="text" id="addPrizeUsername" class="code-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px;">å¥–å“</label>
                        <select id="addPrizeType" class="code-input" style="height: 50px;">
                            <option value="8.8å…ƒç°é‡‘çº¢åŒ…">8.8å…ƒç°é‡‘çº¢åŒ…</option>
                            <option value="6.6å…ƒç°é‡‘çº¢åŒ…">6.6å…ƒç°é‡‘çº¢åŒ…</option>
                            <option value="20å…ƒä»£é‡‘åˆ¸">20å…ƒä»£é‡‘åˆ¸</option>
                            <option value="25å…ƒä»£é‡‘åˆ¸">25å…ƒä»£é‡‘åˆ¸</option>
                            <option value="ä»·å€¼299å…ƒé‹å­æ¬¾å¼è‡ªé€‰">ä»·å€¼299å…ƒé‹å­æ¬¾å¼è‡ªé€‰</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px;">æ—¶é—´</label>
                        <input type="datetime-local" id="addPrizeTime" class="code-input">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px;">æ ¸éªŒçŠ¶æ€</label>
                        <select id="addPrizeVerified" class="code-input" style="height: 50px;">
                            <option value="false">æœªæ ¸éªŒ</option>
                            <option value="true">å·²æ ¸éªŒ</option>
                        </select>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="addPrizeCancel" class="btn btn-info">å–æ¶ˆ</button>
                <button id="addPrizeSubmit" class="btn">æ·»åŠ </button>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <div id="loadingOverlay" class="loading-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 9999; visibility: hidden; opacity: 0; transition: visibility 0s, opacity 0.3s ease;">
        <div class="loading-content" style="background-color: white; padding: 30px; border-radius: 10px; text-align: center; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
            <div class="loading-spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #ffd166; border-radius: 50%; width: 40px; height: 40px; margin: 0 auto 20px; animation: spin 1s linear infinite;"></div>
            <p id="loadingText" style="margin: 0; color: #333;">åŠ è½½ä¸­...</p>
        </div>
        <style>
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>
    </div>
    
    <!-- ç®¡ç†å‘˜å…¥å£ -->
    <button id="adminEnter" class="admin-enter">ç®¡ç†</button>
    
    <script>
        // ç­‰å¾…DOMåŠ è½½å®Œæˆåæ‰§è¡Œæ‰€æœ‰ä»£ç 
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹æ‰§è¡Œè„šæœ¬');
            
            // å¸¸é‡å®šä¹‰
            const CODE_PASSWORD = 'mqpz';
            const MUST_WIN_TIMES = 10;
            const ADMIN_PWD = '@Lei20060610';
        
        // å¯ç”¨è…¾è®¯äº‘COSå®ç°è·¨è®¾å¤‡æ•°æ®å…±äº«
        window.cos = null;
        try {
            // åˆå§‹åŒ–è…¾è®¯äº‘COSå®¢æˆ·ç«¯
            console.log('å¼€å§‹åˆå§‹åŒ–è…¾è®¯äº‘COS');
            // è¿™é‡Œä½¿ç”¨è…¾è®¯äº‘COSçš„JavaScript SDK
            // å®é™…ä½¿ç”¨æ—¶éœ€è¦æ›¿æ¢ä¸ºçœŸå®çš„é…ç½®
            window.cosConfig = {
                Bucket: 'laide446-1403757360',
                Region: 'ap-chengdu',
                SecretId: 'AKIDtfFh1CHDL0Y4Qkw53qU5f4HH3d1CAub5',
                SecretKey: 'LSn2AJTUKRUakjW7WpEmGoP9pCzmRyMY'
            };
            console.log('è…¾è®¯äº‘COSé…ç½®å·²è®¾ç½®');
            console.log('ç³»ç»Ÿå°†ä½¿ç”¨è…¾è®¯äº‘COSå®ç°è·¨è®¾å¤‡æ•°æ®å…±äº«');
            
            // ä»è…¾è®¯äº‘COSåŠ è½½æ‰€æœ‰æ•°æ®å°†åœ¨initå‡½æ•°ä¸­è°ƒç”¨
        } catch (error) {
            console.error('åˆå§‹åŒ–è…¾è®¯äº‘COSå¤±è´¥:', error);
            console.log('è…¾è®¯äº‘COSåˆå§‹åŒ–å¤±è´¥ï¼Œç³»ç»Ÿå°†æ— æ³•æ­£å¸¸è¿è¡Œ');
        }
        
        // å¥–å“é…ç½®
        const PRIZES = {
            cash88: '8.8å…ƒç°é‡‘çº¢åŒ…',
            cash66: '6.6å…ƒç°é‡‘çº¢åŒ…',
            coupon20: '20å…ƒä»£é‡‘åˆ¸',
            coupon25: '25å…ƒä»£é‡‘åˆ¸',
            shoe: 'ä»·å€¼299å…ƒé‹å­æ¬¾å¼è‡ªé€‰'
        };
        
        // å¥–å“æ¦‚ç‡é…ç½®ï¼ˆé»˜è®¤å€¼ï¼‰
        let PRIZE_PROBABILITIES = {
            cash88: 10,    // 10%
            cash66: 20,    // 20%
            coupon20: 30,  // 30%
            coupon25: 30,  // 30%
            shoe: 10       // 10%ï¼ˆå®é™…ä¼šæ ¹æ®MUST_WIN_TIMESé€»è¾‘è°ƒæ•´ï¼‰
        };
        
        // åŠ è½½æ¦‚ç‡é…ç½®
        function loadProbabilityConfig() {
            const storedConfig = localStorage.getItem('draw_prize_probabilities');
            if (storedConfig) {
                try {
                    PRIZE_PROBABILITIES = JSON.parse(storedConfig);
                    console.log('åŠ è½½æ¦‚ç‡é…ç½®:', PRIZE_PROBABILITIES);
                } catch (error) {
                    console.error('åŠ è½½æ¦‚ç‡é…ç½®å¤±è´¥:', error);
                }
            }
        }
        
        // ä¿å­˜æ¦‚ç‡é…ç½®
        function saveProbabilityConfig() {
            localStorage.setItem('draw_prize_probabilities', JSON.stringify(PRIZE_PROBABILITIES));
            console.log('ä¿å­˜æ¦‚ç‡é…ç½®:', PRIZE_PROBABILITIES);
        }
        
        // æ›´æ–°æ¦‚ç‡é…ç½®æ¨¡æ€æ¡†ä¸­çš„å€¼
        function updateProbabilityModal() {
            document.getElementById('prob-cash88').value = PRIZE_PROBABILITIES.cash88;
            document.getElementById('prob-cash66').value = PRIZE_PROBABILITIES.cash66;
            document.getElementById('prob-coupon20').value = PRIZE_PROBABILITIES.coupon20;
            document.getElementById('prob-coupon25').value = PRIZE_PROBABILITIES.coupon25;
            document.getElementById('prob-shoe').value = PRIZE_PROBABILITIES.shoe;
            calculateTotalProbability();
        }
        
        // è®¡ç®—æ€»æ¦‚ç‡
        function calculateTotalProbability() {
            const cash88 = parseInt(document.getElementById('prob-cash88').value) || 0;
            const cash66 = parseInt(document.getElementById('prob-cash66').value) || 0;
            const coupon20 = parseInt(document.getElementById('prob-coupon20').value) || 0;
            const coupon25 = parseInt(document.getElementById('prob-coupon25').value) || 0;
            const shoe = parseInt(document.getElementById('prob-shoe').value) || 0;
            
            const total = cash88 + cash66 + coupon20 + coupon25 + shoe;
            const totalProbability = document.getElementById('totalProbability');
            if (totalProbability) {
                totalProbability.textContent = `${total}%`;
                // æ ¹æ®æ€»æ¦‚ç‡å€¼æ”¹å˜é¢œè‰²
                if (total === 100) {
                    totalProbability.style.color = '#28a745';
                } else if (total > 95 && total < 105) {
                    totalProbability.style.color = '#ffc107';
                } else {
                    totalProbability.style.color = '#dc3545';
                }
            }
        }
        
        // åˆå§‹åŒ–æ¦‚ç‡é…ç½®äº‹ä»¶
        function initProbabilityConfig() {
            // æ‰“å¼€æ¦‚ç‡é…ç½®æ¨¡æ€æ¡†
            const probabilityBtn = document.getElementById('probabilityBtn');
            if (probabilityBtn) {
                probabilityBtn.addEventListener('click', function() {
                    updateProbabilityModal();
                    const probabilityModal = document.getElementById('probabilityModal');
                    if (probabilityModal) {
                        probabilityModal.classList.add('show');
                    }
                });
            }
            
            // å…³é—­æ¦‚ç‡é…ç½®æ¨¡æ€æ¡†
            const probabilityCancel = document.getElementById('probabilityCancel');
            if (probabilityCancel) {
                probabilityCancel.addEventListener('click', function() {
                    const probabilityModal = document.getElementById('probabilityModal');
                    if (probabilityModal) {
                        probabilityModal.classList.remove('show');
                    }
                });
            }
            
            // ä¿å­˜æ¦‚ç‡é…ç½®
            const probabilitySave = document.getElementById('probabilitySave');
            if (probabilitySave) {
                probabilitySave.addEventListener('click', function() {
                    const cash88 = parseInt(document.getElementById('prob-cash88').value) || 0;
                    const cash66 = parseInt(document.getElementById('prob-cash66').value) || 0;
                    const coupon20 = parseInt(document.getElementById('prob-coupon20').value) || 0;
                    const coupon25 = parseInt(document.getElementById('prob-coupon25').value) || 0;
                    const shoe = parseInt(document.getElementById('prob-shoe').value) || 0;
                    
                    PRIZE_PROBABILITIES = {
                        cash88: cash88,
                        cash66: cash66,
                        coupon20: coupon20,
                        coupon25: coupon25,
                        shoe: shoe
                    };
                    
                    saveProbabilityConfig();
                    
                    const probabilityModal = document.getElementById('probabilityModal');
                    if (probabilityModal) {
                        probabilityModal.classList.remove('show');
                    }
                    
                    showTipModal('ä¿å­˜æˆåŠŸ', 'âœ… ä¸­å¥–æ¦‚ç‡é…ç½®å·²ä¿å­˜ï¼');
                });
            }
        }
        
        // XSSé˜²æŠ¤ï¼šè½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ç”ŸæˆCSRFä»¤ç‰Œ
        function generateCsrfToken() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }
        
        // åˆå§‹åŒ–CSRFä»¤ç‰Œ
        function initCsrfToken() {
            if (!localStorage.getItem('csrfToken')) {
                localStorage.setItem('csrfToken', generateCsrfToken());
            }
        }
        
        // éªŒè¯CSRFä»¤ç‰Œ
        function validateCsrfToken(token) {
            return token === localStorage.getItem('csrfToken');
        }
        
        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
        function showLoading(text = 'åŠ è½½ä¸­...') {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            if (loadingOverlay) {
                if (loadingText) {
                    loadingText.textContent = text;
                }
                loadingOverlay.style.visibility = 'visible';
                loadingOverlay.style.opacity = '1';
            }
        }
        
        // éšè—åŠ è½½çŠ¶æ€
        function hideLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.style.visibility = 'hidden';
                loadingOverlay.style.opacity = '0';
            }
        }
        
        // æ˜¾ç¤ºæç¤ºæ¨¡æ€æ¡†
        function showTipModal(title, content) {
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const tipModal = document.getElementById('tipModal');
            if (modalTitle) {
                modalTitle.textContent = title;
            }
            if (modalContent) {
                modalContent.textContent = content;
            }
            if (tipModal) {
                tipModal.classList.add('show');
            }
        }
        
        // æ·»åŠ é€šçŸ¥
        function addNotification(message, type = 'info') {
            console.log('æ·»åŠ é€šçŸ¥:', message, type);
            
            // åˆ›å»ºé€šçŸ¥å¯¹è±¡
            const notification = {
                id: Date.now(),
                message: message,
                type: type,
                time: new Date().toLocaleString(),
                read: false
            };
            
            // åŠ è½½ç°æœ‰é€šçŸ¥
            let notifications = [];
            try {
                const stored = localStorage.getItem('lottery_notifications');
                if (stored) {
                    notifications = JSON.parse(stored);
                }
            } catch (error) {
                console.error('åŠ è½½é€šçŸ¥å¤±è´¥:', error);
                notifications = [];
            }
            
            // æ·»åŠ æ–°é€šçŸ¥åˆ°å¼€å¤´
            notifications.unshift(notification);
            
            // é™åˆ¶é€šçŸ¥æ•°é‡
            if (notifications.length > 20) {
                notifications = notifications.slice(0, 20);
            }
            
            // ä¿å­˜é€šçŸ¥
            localStorage.setItem('lottery_notifications', JSON.stringify(notifications));
            
            // æ˜¾ç¤ºé€šçŸ¥æç¤º
            showNotificationBadge();
        }
        
        // æ˜¾ç¤ºé€šçŸ¥å¾½ç« 
        function showNotificationBadge() {
            // è¿™é‡Œå¯ä»¥å®ç°é€šçŸ¥å¾½ç« çš„æ˜¾ç¤ºé€»è¾‘
            console.log('é€šçŸ¥å·²æ·»åŠ ï¼Œå¯åœ¨é€šçŸ¥ä¸­å¿ƒæŸ¥çœ‹');
        }
        
        // è·å–æœªè¯»é€šçŸ¥
        function getUnreadNotifications() {
            try {
                const stored = localStorage.getItem('lottery_notifications');
                if (stored) {
                    const notifications = JSON.parse(stored);
                    return notifications.filter(n => !n.read);
                }
            } catch (error) {
                console.error('è·å–æœªè¯»é€šçŸ¥å¤±è´¥:', error);
            }
            return [];
        }
        
        // æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»
        function markNotificationAsRead(notificationId) {
            try {
                const stored = localStorage.getItem('lottery_notifications');
                if (stored) {
                    const notifications = JSON.parse(stored);
                    const updated = notifications.map(n => {
                        if (n.id === notificationId) {
                            return { ...n, read: true };
                        }
                        return n;
                    });
                    localStorage.setItem('lottery_notifications', JSON.stringify(updated));
                }
            } catch (error) {
                console.error('æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»å¤±è´¥:', error);
            }
        }
        
        // æ ‡è®°å…¨éƒ¨é€šçŸ¥ä¸ºå·²è¯»
        function markAllNotificationsAsRead() {
            try {
                const stored = localStorage.getItem('lottery_notifications');
                if (stored) {
                    const notifications = JSON.parse(stored);
                    const updated = notifications.map(n => ({
                        ...n,
                        read: true
                    }));
                    localStorage.setItem('lottery_notifications', JSON.stringify(updated));
                }
            } catch (error) {
                console.error('æ ‡è®°å…¨éƒ¨é€šçŸ¥ä¸ºå·²è¯»å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥ä¸­å¿ƒ
        function showNotificationCenter() {
            console.log('æ˜¾ç¤ºé€šçŸ¥ä¸­å¿ƒ');
            
            // åŠ è½½é€šçŸ¥
            let notifications = [];
            try {
                const stored = localStorage.getItem('lottery_notifications');
                if (stored) {
                    notifications = JSON.parse(stored);
                }
            } catch (error) {
                console.error('åŠ è½½é€šçŸ¥å¤±è´¥:', error);
                notifications = [];
            }
            
            // æ˜¾ç¤ºé€šçŸ¥
            if (notificationList) {
                if (notifications.length === 0) {
                    notificationList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">æš‚æ— é€šçŸ¥</div>';
                } else {
                    notificationList.innerHTML = notifications.map(notification => {
                        const typeClass = {
                            'info': 'info',
                            'prize': 'success',
                            'warning': 'warning',
                            'error': 'danger'
                        }[notification.type] || 'info';
                        
                        return `
                            <div style="padding: 15px; margin-bottom: 10px; border-radius: 8px; background-color: ${notification.read ? '#f8f9fa' : '#e3f2fd'};">
                                <div style="font-weight: ${notification.read ? 'normal' : 'bold'}; margin-bottom: 5px;">${notification.message}</div>
                                <div style="font-size: 12px; color: #666; display: flex; justify-content: space-between; align-items: center;">
                                    <span>${notification.time}</span>
                                    ${!notification.read ? `<button onclick="markNotificationAsRead(${notification.id}); showNotificationCenter();" style="background-color: #17a2b8; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 12px; cursor: pointer;">æ ‡è®°å·²è¯»</button>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            }
            
            // æ˜¾ç¤ºé€šçŸ¥æ¨¡æ€æ¡†
            if (notificationModal) {
                notificationModal.classList.add('show');
            }
        }
        
        // å­˜å‚¨é”®å
        const STORAGE_KEYS = {
            users: 'lottery_users',
            currentUser: 'lottery_currentUser',
            leftCount: 'lottery_leftCount',
            userDrawCount: 'lottery_userDrawCount',
            recordList: 'lottery_recordList',
            usedCodes: 'lottery_usedCodes',
            globalUserData: 'lottery_globalUserData',
            notification: 'lottery_notification',
            userPrizePools: 'lottery_userPrizePools'
        };
        
        // å˜é‡å®šä¹‰
        let currentUser = '';
        let leftCount = 0;
        let userDrawCount = 0;
        let recordList = [];
        let users = {};
        let usedCodes = [];
        let globalUserData = {};
        let exchangeCodesData = {}; // å­˜å‚¨æ‰€æœ‰ç”Ÿæˆçš„å…‘æ¢ç åŠå…¶çŠ¶æ€
        let userPrizePools = {};
        let userCode = '';
        
        // å…¨å±€éªŒè¯ç å˜é‡
        let loginCaptchaValue = '';
        let regCaptchaValue = '';
        
        // é¡µé¢å…ƒç´ 
        let authPage, userPage, adminPage;
        let loginForm, registerForm, adminLogin, adminMain;
        let username, password, regUsername, regPassword, regConfirmPassword, adminPwd;
        let userLoginBtn, registerBtn, adminLoginBtn, showRegisterBtn, showLoginBtn;
        let bindCodeBtn, exchangeCode, codeError;
        let scratchCanvas, scratchResult, scratchContainer;
        let leftCountSpan, countTip;
        let recordListEl, recordContainer;
        let adminEnter, backBtn;
        let modalTitle, modalContent, tipModal, modalClose;
        let adminPwdErrorTip, authError;
        let userList, totalUserNum, totalDrawNum, totalShoeUser, totalUsedCode;
        let searchUserInput, searchBtn;
        let refreshDataBtn, clearAllDataBtn, exportBtn, addPrizeBtn;
        let probabilityBtn, probabilityModal, probabilityCancel, probabilitySave, totalProbability;
        let codeManageBtn, codeManageModal, codeManageCancel, generateCodeBtn, codeResult, copyCodesBtn, codeDrawTimes, codeGenerateCount;
        let forgotPasswordBtn, resetPasswordModal, resetPasswordCancel, resetPasswordSubmit, resetUsername, resetPassword, resetConfirmPassword;
        let loadingOverlay, loadingText;
        let tickerContent;
        let currentUserEl, logoutBtn, notificationBtn;
        let loginCaptcha, loginCaptchaImg, regCaptcha, regCaptchaImg;
        let notificationModal, notificationList, notificationMarkAllRead, notificationClose;
        
        // è·å–DOMå…ƒç´ 
        function getDOMElements() {
            console.log('å¼€å§‹è·å–DOMå…ƒç´ ...');
            
            // é¡µé¢å®¹å™¨
            authPage = document.getElementById('authPage');
            userPage = document.getElementById('userPage');
            adminPage = document.getElementById('adminPage');
            console.log('é¡µé¢å®¹å™¨:', { authPage, userPage, adminPage });
            
            // è¡¨å•å…ƒç´ 
            loginForm = document.getElementById('loginForm');
            registerForm = document.getElementById('registerForm');
            adminLogin = document.getElementById('adminLogin');
            adminMain = document.getElementById('adminMain');
            console.log('è¡¨å•å…ƒç´ :', { loginForm, registerForm, adminLogin, adminMain });
            
            // è¾“å…¥æ¡†
            username = document.getElementById('username');
            password = document.getElementById('password');
            regUsername = document.getElementById('regUsername');
            regPassword = document.getElementById('regPassword');
            regConfirmPassword = document.getElementById('regConfirmPassword');
            adminPwd = document.getElementById('adminPwd');
            exchangeCode = document.getElementById('exchangeCode');
            searchUserInput = document.getElementById('searchUserInput');
            codeDrawTimes = document.getElementById('codeDrawTimes');
            codeGenerateCount = document.getElementById('codeGenerateCount');
            resetUsername = document.getElementById('resetUsername');
            resetPassword = document.getElementById('resetPassword');
            resetConfirmPassword = document.getElementById('resetConfirmPassword');
            loginCaptcha = document.getElementById('loginCaptcha');
            regCaptcha = document.getElementById('regCaptcha');
            console.log('è¾“å…¥æ¡†:', { username, password, regUsername, regPassword, regConfirmPassword, adminPwd });
            
            // éªŒè¯ç å›¾ç‰‡
            loginCaptchaImg = document.getElementById('loginCaptchaImg');
            regCaptchaImg = document.getElementById('regCaptchaImg');
            console.log('éªŒè¯ç å›¾ç‰‡:', { loginCaptchaImg, regCaptchaImg });
            
            // æŒ‰é’®
            userLoginBtn = document.getElementById('userLoginBtn');
            registerBtn = document.getElementById('registerBtn');
            adminLoginBtn = document.getElementById('adminLoginBtn');
            showRegisterBtn = document.getElementById('showRegisterBtn');
            showLoginBtn = document.getElementById('showLoginBtn');
            bindCodeBtn = document.getElementById('bindCodeBtn');
            adminEnter = document.getElementById('adminEnter');
            backBtn = document.getElementById('backBtn');
            modalClose = document.getElementById('modalClose');
            searchBtn = document.getElementById('searchBtn');
            refreshDataBtn = document.getElementById('refreshDataBtn');
            clearAllDataBtn = document.getElementById('clearAllDataBtn');
            exportBtn = document.getElementById('exportBtn');
            addPrizeBtn = document.getElementById('addPrizeBtn');
            probabilityBtn = document.getElementById('probabilityBtn');
            probabilityCancel = document.getElementById('probabilityCancel');
            probabilitySave = document.getElementById('probabilitySave');
            codeManageBtn = document.getElementById('codeManageBtn');
            codeManageCancel = document.getElementById('codeManageCancel');
            generateCodeBtn = document.getElementById('generateCodeBtn');
            copyCodesBtn = document.getElementById('copyCodesBtn');
            forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
            resetPasswordCancel = document.getElementById('resetPasswordCancel');
            resetPasswordSubmit = document.getElementById('resetPasswordSubmit');
            logoutBtn = document.getElementById('logoutBtn');
            notificationBtn = document.getElementById('notificationBtn');
            notificationMarkAllRead = document.getElementById('notificationMarkAllRead');
            notificationClose = document.getElementById('notificationClose');
            console.log('æŒ‰é’®:', { userLoginBtn, registerBtn, adminLoginBtn, showRegisterBtn, showLoginBtn, bindCodeBtn, adminEnter, notificationBtn });
            
            // å…¶ä»–å…ƒç´ 
            codeError = document.getElementById('codeError');
            scratchCanvas = document.getElementById('scratchCanvas');
            scratchResult = document.getElementById('scratchResult');
            scratchContainer = document.getElementById('scratchContainer');
            leftCountSpan = document.getElementById('leftCountSpan');
            countTip = document.getElementById('countTip');
            recordListEl = document.getElementById('recordList');
            recordContainer = document.getElementById('recordContainer');
            modalTitle = document.getElementById('modalTitle');
            modalContent = document.getElementById('modalContent');
            tipModal = document.getElementById('tipModal');
            adminPwdErrorTip = document.getElementById('adminPwdErrorTip');
            authError = document.getElementById('authError');
            userList = document.getElementById('userList');
            totalUserNum = document.getElementById('totalUserNum');
            totalDrawNum = document.getElementById('totalDrawNum');
            totalShoeUser = document.getElementById('totalShoeUser');
            totalUsedCode = document.getElementById('totalUsedCode');
            probabilityModal = document.getElementById('probabilityModal');
            totalProbability = document.getElementById('totalProbability');
            codeManageModal = document.getElementById('codeManageModal');
            codeResult = document.getElementById('codeResult');
            resetPasswordModal = document.getElementById('resetPasswordModal');
            loadingOverlay = document.getElementById('loadingOverlay');
            loadingText = document.getElementById('loadingText');
            tickerContent = document.getElementById('tickerContent');
            currentUserEl = document.getElementById('currentUser');
            notificationModal = document.getElementById('notificationModal');
            notificationList = document.getElementById('notificationList');
            console.log('å…¶ä»–å…ƒç´ :', { scratchCanvas, scratchResult, scratchContainer, adminEnter, notificationModal });
            
            // æ·»åŠ å›è½¦é”®äº‹ä»¶ç›‘å¬å™¨
            console.log('å¼€å§‹æ·»åŠ å›è½¦é”®äº‹ä»¶ç›‘å¬å™¨...');
            
            // ç™»å½•é¡µé¢è¾“å…¥æ¡†
            if (username) {
                username.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') userLoginBtn.click();
                });
            }
            if (password) {
                password.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') userLoginBtn.click();
                });
            }
            if (loginCaptcha) {
                loginCaptcha.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') userLoginBtn.click();
                });
            }
            
            // æ³¨å†Œé¡µé¢è¾“å…¥æ¡†
            if (regUsername) {
                regUsername.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') registerBtn.click();
                });
            }
            if (regPassword) {
                regPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') registerBtn.click();
                });
            }
            if (regConfirmPassword) {
                regConfirmPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') registerBtn.click();
                });
            }
            if (regCaptcha) {
                regCaptcha.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') registerBtn.click();
                });
            }
            
            // å…‘æ¢ç è¾“å…¥æ¡†
            if (exchangeCode) {
                exchangeCode.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') bindCodeBtn.click();
                });
            }
            
            // ç®¡ç†å‘˜ç™»å½•å¯†ç è¾“å…¥æ¡†
            if (adminPwd) {
                adminPwd.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') adminLoginBtn.click();
                });
            }
            
            // æœç´¢è¾“å…¥æ¡†
            if (searchUserInput) {
                searchUserInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') searchBtn.click();
                });
            }
            
            // å¯†ç é‡ç½®é¡µé¢è¾“å…¥æ¡†
            if (resetUsername) {
                resetUsername.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        // å°è¯•è·å–é‡ç½®å¯†ç æŒ‰é’®å¹¶ç‚¹å‡»
                        const resetPasswordSubmit = document.getElementById('resetPasswordSubmit');
                        if (resetPasswordSubmit) resetPasswordSubmit.click();
                    }
                });
            }
            if (resetPassword) {
                resetPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const resetPasswordSubmit = document.getElementById('resetPasswordSubmit');
                        if (resetPasswordSubmit) resetPasswordSubmit.click();
                    }
                });
            }
            if (resetConfirmPassword) {
                resetConfirmPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const resetPasswordSubmit = document.getElementById('resetPasswordSubmit');
                        if (resetPasswordSubmit) resetPasswordSubmit.click();
                    }
                });
            }
            
            console.log('å›è½¦é”®äº‹ä»¶ç›‘å¬å™¨æ·»åŠ å®Œæˆï¼');
            console.log('DOMå…ƒç´ è·å–å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–éªŒè¯ç 
        function initCaptcha() {
            console.log('å¼€å§‹åˆå§‹åŒ–éªŒè¯ç ...');
            
            // ç”ŸæˆéšæœºéªŒè¯ç 
            function generateCaptcha() {
                const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                let captcha = '';
                for (let i = 0; i < 4; i++) {
                    captcha += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return captcha;
            }
            
            // ç»˜åˆ¶éªŒè¯ç 
            function drawCaptcha(element, captcha) {
                if (!element) return;
                
                // æ¸…é™¤åŸæœ‰å†…å®¹
                element.innerHTML = '';
                
                // è®¾ç½®éšæœºèƒŒæ™¯è‰²
                const bgColors = ['#f0f9ff', '#f0fdf4', '#fefce8', '#fef2f2', '#fdf4ff'];
                const bgColor = bgColors[Math.floor(Math.random() * bgColors.length)];
                element.style.backgroundColor = bgColor;
                
                // ç»˜åˆ¶éªŒè¯ç å­—ç¬¦
                for (let i = 0; i < captcha.length; i++) {
                    const span = document.createElement('span');
                    span.textContent = captcha[i];
                    
                    // è®¾ç½®éšæœºæ ·å¼
                    const rotation = (Math.random() - 0.5) * 30; // -15åˆ°15åº¦çš„æ—‹è½¬
                    const fontSize = 16 + Math.random() * 6; // 16-22pxçš„å­—ä½“å¤§å°
                    const colors = ['#1e40af', '#047857', '#92400e', '#991b1b', '#7e22ce'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    span.style.transform = `rotate(${rotation}deg)`;
                    span.style.fontSize = `${fontSize}px`;
                    span.style.color = color;
                    span.style.margin = '0 2px';
                    
                    element.appendChild(span);
                }
            }
            
            // ç™»å½•éªŒè¯ç 
            if (loginCaptchaImg) {
                console.log('åˆå§‹åŒ–ç™»å½•éªŒè¯ç ...');
                loginCaptchaValue = generateCaptcha();
                drawCaptcha(loginCaptchaImg, loginCaptchaValue);
                
                loginCaptchaImg.addEventListener('click', function() {
                    loginCaptchaValue = generateCaptcha();
                    drawCaptcha(loginCaptchaImg, loginCaptchaValue);
                });
                
                // éªŒè¯ç™»å½•éªŒè¯ç 
                window.validateLoginCaptcha = function() {
                    const loginCaptcha = document.getElementById('loginCaptcha');
                    return loginCaptcha.value.toUpperCase() === loginCaptchaValue;
                };
            }
            
            // æ³¨å†ŒéªŒè¯ç 
            if (regCaptchaImg) {
                console.log('åˆå§‹åŒ–æ³¨å†ŒéªŒè¯ç ...');
                regCaptchaValue = generateCaptcha();
                drawCaptcha(regCaptchaImg, regCaptchaValue);
                
                regCaptchaImg.addEventListener('click', function() {
                    regCaptchaValue = generateCaptcha();
                    drawCaptcha(regCaptchaImg, regCaptchaValue);
                });
                
                // éªŒè¯æ³¨å†ŒéªŒè¯ç 
                window.validateRegCaptcha = function() {
                    const regCaptcha = document.getElementById('regCaptcha');
                    return regCaptcha.value.toUpperCase() === regCaptchaValue;
                };
            }
            
            console.log('éªŒè¯ç åˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–å¯†ç é‡ç½®
        function initPasswordReset() {
            console.log('å¼€å§‹åˆå§‹åŒ–å¯†ç é‡ç½®...');
            
            const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
            if (forgotPasswordBtn) {
                forgotPasswordBtn.addEventListener('click', function() {
                    const resetPasswordModal = document.getElementById('resetPasswordModal');
                    if (resetPasswordModal) {
                        resetPasswordModal.classList.add('show');
                    }
                });
            }
            
            const resetPasswordCancel = document.getElementById('resetPasswordCancel');
            if (resetPasswordCancel) {
                resetPasswordCancel.addEventListener('click', function() {
                    const resetPasswordModal = document.getElementById('resetPasswordModal');
                    if (resetPasswordModal) {
                        resetPasswordModal.classList.remove('show');
                    }
                });
            }
            
            const resetPasswordSubmit = document.getElementById('resetPasswordSubmit');
            if (resetPasswordSubmit) {
                resetPasswordSubmit.addEventListener('click', function() {
                    const resetUsername = document.getElementById('resetUsername');
                    const resetPassword = document.getElementById('resetPassword');
                    const resetConfirmPassword = document.getElementById('resetConfirmPassword');
                    
                    const username = resetUsername.value.trim();
                    const password = resetPassword.value;
                    const confirmPassword = resetConfirmPassword.value;
                    
                    if (!username) {
                        showTipModal('é”™è¯¯', 'è¯·è¾“å…¥å¾®ä¿¡å·ï¼');
                        return;
                    }
                    
                    if (!password) {
                        showTipModal('é”™è¯¯', 'è¯·è®¾ç½®æ–°å¯†ç ï¼');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        showTipModal('é”™è¯¯', 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼');
                        return;
                    }
                    
                    if (!users[username]) {
                        showTipModal('é”™è¯¯', 'è¯¥å¾®ä¿¡å·æœªæ³¨å†Œï¼');
                        return;
                    }
                    
                    // é‡ç½®å¯†ç 
                    users[username] = password;
                    localStorage.setItem(STORAGE_KEYS.users, JSON.stringify(users));
                    
                    // ä¿å­˜åˆ°Supabase
                    saveUsersToTencentCOS();
                    
                    showTipModal('æˆåŠŸ', 'å¯†ç é‡ç½®æˆåŠŸï¼');
                    
                    const resetPasswordModal = document.getElementById('resetPasswordModal');
                    if (resetPasswordModal) {
                        resetPasswordModal.classList.remove('show');
                    }
                });
            }
            
            console.log('å¯†ç é‡ç½®åˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–æ»šåŠ¨æ’­æŠ¥
        function initTicker() {
            console.log('å¼€å§‹åˆå§‹åŒ–æ»šåŠ¨æ’­æŠ¥...');
            
            const tickerContent = document.getElementById('tickerContent');
            if (tickerContent) {
                // å¥–é¡¹åˆ—è¡¨
                const prizes = [
                    '88.88å…ƒç°é‡‘çº¢åŒ…',
                    '66.66å…ƒç°é‡‘çº¢åŒ…',
                    '38.88å…ƒç°é‡‘çº¢åŒ…',
                    '18.88å…ƒç°é‡‘çº¢åŒ…',
                    'ä»·å€¼399å…ƒæ¬¾é‹å­ï¼ˆæ¬¾å¼è‡ªé€‰ï¼‰',
                    'ä»·å€¼299å…ƒæ¬¾é‹å­ï¼ˆæ¬¾å¼è‡ªé€‰ï¼‰',
                    'ä»·å€¼199å…ƒæ¬¾é‹å­ï¼ˆæ¬¾å¼è‡ªé€‰ï¼‰'
                ];
                
                // ç”Ÿæˆéšæœºå››ä½æ•°ï¼ˆæ¨¡ä»¿æ‰‹æœºå°¾å·ï¼‰
                function generateRandomTail() {
                    return Math.floor(1000 + Math.random() * 9000);
                }
                
                // ç”Ÿæˆæ»šåŠ¨æ’­æŠ¥å†…å®¹
                const tickerItems = [];
                for (let i = 0; i < 10; i++) {
                    const tailNumber = generateRandomTail();
                    const prize = prizes[Math.floor(Math.random() * prizes.length)];
                    const item = `ğŸ‰ğŸ‰æ­å–œç”¨æˆ·${tailNumber}è·å¾—${prize}`;
                    tickerItems.push(item);
                }
                
                tickerItems.forEach(item => {
                    const tickerItem = document.createElement('div');
                    tickerItem.className = 'ticker-item';
                    tickerItem.textContent = item;
                    tickerContent.appendChild(tickerItem);
                });
                
                // ä¼˜åŒ–æ»šåŠ¨åŠ¨ç”»
                let position = 0;
                const speed = 0.5; // è°ƒæ•´æ»šåŠ¨é€Ÿåº¦ï¼Œå€¼è¶Šå°è¶Šæµç•…
                
                // å…‹éš†å†…å®¹ä»¥å®ç°æ— ç¼æ»šåŠ¨
                const cloneContent = document.createElement('div');
                cloneContent.className = 'ticker-content';
                tickerItems.forEach(item => {
                    const tickerItem = document.createElement('div');
                    tickerItem.className = 'ticker-item';
                    tickerItem.textContent = item;
                    cloneContent.appendChild(tickerItem);
                });
                tickerContent.appendChild(cloneContent);
                
                function scrollTicker() {
                    position -= speed;
                    
                    // è®¡ç®—æ€»å®½åº¦
                    const totalWidth = tickerContent.offsetWidth / 2;
                    
                    // å½“æ»šåŠ¨åˆ°ä¸€åŠæ—¶é‡ç½®ä½ç½®ï¼Œå®ç°æ— ç¼æ»šåŠ¨
                    if (position < -totalWidth) {
                        position = 0;
                    }
                    
                    // ä½¿ç”¨transformè¿›è¡ŒåŠ¨ç”»ï¼Œåˆ©ç”¨GPUåŠ é€Ÿ
                    tickerContent.style.transform = `translateX(${position}px)`;
                    tickerContent.style.willChange = 'transform'; // å‘Šè¯‰æµè§ˆå™¨å°†è¦å‘ç”Ÿå˜åŒ–ï¼Œæå‰ä¼˜åŒ–
                    
                    requestAnimationFrame(scrollTicker);
                }
                
                // ç¡®ä¿å®¹å™¨æœ‰è¶³å¤Ÿçš„å®½åº¦
                tickerContent.style.whiteSpace = 'nowrap';
                tickerContent.style.display = 'flex';
                tickerContent.style.alignItems = 'center';
                
                scrollTicker();
            }
            
            console.log('æ»šåŠ¨æ’­æŠ¥åˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–åˆ®åˆ®ä¹
        function initScratch() {
            console.log('å¼€å§‹åˆå§‹åŒ–åˆ®åˆ®ä¹...');
            
            if (scratchCanvas) {
                const canvas = scratchCanvas;
                const ctx = canvas.getContext('2d');
                
                // è®¾ç½®ç”»å¸ƒå°ºå¯¸
                function resizeCanvas() {
                    // ç¡®ä¿å®¹å™¨å¯è§æ—¶å†è®¾ç½®å°ºå¯¸
                    if (!scratchContainer.classList.contains('hidden')) {
                        canvas.width = canvas.offsetWidth;
                        canvas.height = canvas.offsetHeight;
                        ctx.fillStyle = '#ffbe0b';
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                        console.log('è°ƒæ•´ç”»å¸ƒå°ºå¯¸:', canvas.width, 'x', canvas.height);
                    }
                }
                
                // åˆå§‹è°ƒæ•´å°ºå¯¸
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                
                let isScratching = false;
                
                // åˆ®æ“¦æ•ˆæœ
                function scratch(x, y) {
                    ctx.globalCompositeOperation = 'destination-out';
                    ctx.beginPath();
                    ctx.arc(x, y, 30, 0, 2 * Math.PI);
                    ctx.fill();
                }
                
                // é¼ æ ‡äº‹ä»¶
                canvas.addEventListener('mousedown', function(e) {
                    console.log('é¼ æ ‡æŒ‰ä¸‹');
                    isScratching = true;
                    canvas.style.cursor = 'grabbing';
                    const rect = canvas.getBoundingClientRect();
                    scratch(e.clientX - rect.left, e.clientY - rect.top);
                });
                
                canvas.addEventListener('mousemove', function(e) {
                    if (isScratching) {
                        const rect = canvas.getBoundingClientRect();
                        scratch(e.clientX - rect.left, e.clientY - rect.top);
                    }
                });
                
                canvas.addEventListener('mouseup', function() {
                    console.log('é¼ æ ‡é‡Šæ”¾');
                    isScratching = false;
                    canvas.style.cursor = 'grab';
                });
                
                canvas.addEventListener('mouseleave', function() {
                    console.log('é¼ æ ‡ç¦»å¼€');
                    isScratching = false;
                    canvas.style.cursor = 'grab';
                });
                
                // è§¦æ‘¸äº‹ä»¶
                canvas.addEventListener('touchstart', function(e) {
                    console.log('è§¦æ‘¸å¼€å§‹');
                    isScratching = true;
                    const rect = canvas.getBoundingClientRect();
                    const touch = e.touches[0];
                    scratch(touch.clientX - rect.left, touch.clientY - rect.top);
                }, { passive: true });
                
                canvas.addEventListener('touchmove', function(e) {
                    if (isScratching) {
                        const rect = canvas.getBoundingClientRect();
                        const touch = e.touches[0];
                        scratch(touch.clientX - rect.left, touch.clientY - rect.top);
                    }
                }, { passive: true });
                
                canvas.addEventListener('touchend', function() {
                    console.log('è§¦æ‘¸ç»“æŸ');
                    isScratching = false;
                });
                
                // è®¾ç½®é»˜è®¤å…‰æ ‡
                canvas.style.cursor = 'grab';
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                canvas.addEventListener('mouseover', function() {
                    if (!isScratching) {
                        canvas.style.cursor = 'grab';
                    }
                });
                
                // é‡ç½®åˆ®åˆ®ä¹
                window.resetScratch = function() {
                    console.log('é‡ç½®åˆ®åˆ®ä¹');
                    resizeCanvas();
                    // é‡ç½®ä¸­å¥–ä¿¡æ¯æ˜¾ç¤º
                    if (scratchResult) {
                        scratchResult.innerHTML = 'æ»‘åŠ¨åˆ®å¼€<br>æ¬¡æ¬¡æœ‰å¥–';
                    }
                };
                
                // æ£€æµ‹åˆ®å¼€é¢ç§¯
                function checkScratchProgress() {
                    const canvas = scratchCanvas;
                    const ctx = canvas.getContext('2d');
                    const width = canvas.width;
                    const height = canvas.height;
                    const imageData = ctx.getImageData(0, 0, width, height);
                    const data = imageData.data;
                    let clearPixels = 0;
                    let totalPixels = width * height;
                    
                    for (let i = 0; i < data.length; i += 4) {
                        if (data[i + 3] === 0) {
                            clearPixels++;
                        }
                    }
                    
                    return (clearPixels / totalPixels) * 100;
                }
                
                // åˆ®å¼€ç»“æŸå¤„ç†
                function handleScratchComplete() {
                    console.log('åˆ®å¼€å®Œæˆï¼Œå¼€å§‹å¤„ç†ä¸­å¥–é€»è¾‘');
                    
                    // ç”Ÿæˆä¸­å¥–ç»“æœ
                    const prize = getRandomPrize();
                    console.log('ä¸­å¥–ç»“æœ:', prize);
                    
                    // æ˜¾ç¤ºä¸­å¥–ä¿¡æ¯ï¼ˆæ·»åŠ å…¥åœºåŠ¨ç”»ï¼‰
                    if (scratchResult) {
                        scratchResult.innerHTML = `æ­å–œè·å¾—<br>${prize}`;
                        scratchResult.style.animation = 'none';
                        scratchResult.offsetHeight; // è§¦å‘é‡æ’
                        scratchResult.style.animation = 'prizeAppear 0.8s ease-out forwards';
                    }
                    
                    // å‡å°‘æŠ½å¥–æ¬¡æ•°
                    leftCount--;
                    userDrawCount++;
                    
                    // æ·»åŠ ä¸­å¥–è®°å½•
                    const record = {
                        prize: prize,
                        time: new Date().toLocaleString(),
                        verified: false
                    };
                    recordList.unshift(record);
                    
                    // æ·»åŠ ä¸­å¥–é€šçŸ¥
                    addNotification(`ğŸ‰ æ­å–œä¸­å¥–ï¼æ‚¨è·å¾—äº†ï¼š${prize}`, 'prize');
                    
                    // ä¿å­˜æ•°æ®
                    saveUserData();
                    
                    // å»¶è¿Ÿæ˜¾ç¤ºä¸­å¥–å¼¹çª—ï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°åˆ®å¼€ç»“æœ
                    setTimeout(() => {
                        showTipModal('ğŸ‰ æ­å–œä¸­å¥–', `æ‚¨è·å¾—äº†ï¼š${prize}`);
                    }, 500);
                    
                    // æ›´æ–°é¡µé¢æ˜¾ç¤º
                    updatePageDisplay();
                }
                
                // ç›‘å¬åˆ®å¼€äº‹ä»¶ï¼Œæ·»åŠ åˆ®å¼€å®Œæˆæ£€æµ‹
                let scratchTimeout;
                canvas.addEventListener('mouseup', function() {
                    console.log('é¼ æ ‡é‡Šæ”¾');
                    isScratching = false;
                    clearTimeout(scratchTimeout);
                    scratchTimeout = setTimeout(() => {
                        const progress = checkScratchProgress();
                        console.log('åˆ®å¼€è¿›åº¦:', progress);
                        if (progress > 30) {
                            handleScratchComplete();
                        }
                    }, 500);
                });
                
                canvas.addEventListener('touchend', function() {
                    console.log('è§¦æ‘¸ç»“æŸ');
                    isScratching = false;
                    clearTimeout(scratchTimeout);
                    scratchTimeout = setTimeout(() => {
                        const progress = checkScratchProgress();
                        console.log('åˆ®å¼€è¿›åº¦:', progress);
                        if (progress > 30) {
                            handleScratchComplete();
                        }
                    }, 500);
                });
            }
            
            console.log('åˆ®åˆ®ä¹åˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç»‘å®š
        function bindEvents() {
            console.log('å¼€å§‹åˆå§‹åŒ–äº‹ä»¶ç»‘å®š...');
            
            // ç™»å½•æŒ‰é’®
            if (userLoginBtn) {
                console.log('ç»‘å®šç™»å½•æŒ‰é’®äº‹ä»¶...');
                userLoginBtn.addEventListener('click', function() {
                    const username = document.getElementById('username').value.trim();
                    const password = document.getElementById('password').value;
                    
                    if (!username) {
                        if (authError) {
                            authError.textContent = 'è¯·è¾“å…¥å¾®ä¿¡å·ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    if (!password) {
                        if (authError) {
                            authError.textContent = 'è¯·è¾“å…¥å¯†ç ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    // éªŒè¯éªŒè¯ç 
                    if (!window.validateLoginCaptcha()) {
                        if (authError) {
                            authError.textContent = 'éªŒè¯ç é”™è¯¯ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    // éªŒè¯ç”¨æˆ·
                    if (users[username] === password) {
                        currentUser = username;
                        
                        if (authError) {
                            authError.classList.add('hidden');
                        }
                        
                        // è®°å½•ç™»å½•æ—¶é—´å’ŒIPåœ°å€
                        const loginTime = new Date().toLocaleString();
                        console.log('ç”¨æˆ·ç™»å½•æ—¶é—´:', loginTime);
                        
                        // åŠ è½½ç”¨æˆ·æ•°æ®å¹¶è·³è½¬åˆ°ç”¨æˆ·é¡µé¢
                        loadUserData();
                        
                        // æ›´æ–°ç™»å½•æ—¶é—´å’ŒIPåœ°å€
                        if (globalUserData[username]) {
                            globalUserData[username].lastLoginTime = loginTime;
                            
                            // è·å–ç”¨æˆ·IPåœ°å€ï¼ˆæ·»åŠ è¯¦ç»†é”™è¯¯å¤„ç†ï¼‰
                            try {
                                fetch('https://api.ipify.org?format=json')
                                    .then(response => {
                                        if (!response.ok) {
                                            throw new Error('ç½‘ç»œå“åº”å¤±è´¥');
                                        }
                                        return response.json();
                                    })
                                    .then(data => {
                                        const ipAddress = data.ip;
                                        console.log('ç”¨æˆ·IPåœ°å€:', ipAddress);
                                        globalUserData[username].lastLoginIP = ipAddress;
                                    })
                                    .catch(error => {
                                        console.log('è·å–IPåœ°å€å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:', error.message);
                                    })
                                    .finally(() => {
                                        // æ— è®ºæ˜¯å¦è·å–åˆ°IPåœ°å€ï¼Œéƒ½ä¿å­˜æ•°æ®
                                        saveUsersToTencentCOS();
                                    });
                            } catch (error) {
                                console.log('è·å–IPåœ°å€å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:', error.message);
                                saveUsersToTencentCOS();
                            }
                        }
                        
                        initPage();
                        
                        // æ£€æŸ¥é€šçŸ¥
                        // ç§»é™¤æœ¬åœ°å­˜å‚¨é€šçŸ¥ï¼Œæ”¹ä¸ºç›´æ¥æ˜¾ç¤ºæç¤º
                        console.log('ç”¨æˆ·ç™»å½•æˆåŠŸ');
                        showTipModal('æˆåŠŸ', 'ç™»å½•æˆåŠŸï¼');
                    } else {
                        if (authError) {
                            authError.textContent = 'å¾®ä¿¡å·æˆ–å¯†ç é”™è¯¯ï¼';
                            authError.classList.remove('hidden');
                        }
                    }
                });
            }
            
            // æ³¨å†ŒæŒ‰é’®
            if (registerBtn) {
                console.log('ç»‘å®šæ³¨å†ŒæŒ‰é’®äº‹ä»¶...');
                registerBtn.addEventListener('click', function() {
                    const username = document.getElementById('regUsername').value.trim();
                    const password = document.getElementById('regPassword').value;
                    const confirmPassword = document.getElementById('regConfirmPassword').value;
                    
                    if (!username) {
                        if (authError) {
                            authError.textContent = 'è¯·è¾“å…¥å¾®ä¿¡å·ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    if (!password) {
                        if (authError) {
                            authError.textContent = 'è¯·è®¾ç½®å¯†ç ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        if (authError) {
                            authError.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    // éªŒè¯éªŒè¯ç 
                    if (!window.validateRegCaptcha()) {
                        if (authError) {
                            authError.textContent = 'éªŒè¯ç é”™è¯¯ï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    if (users[username]) {
                        if (authError) {
                            authError.textContent = 'è¯¥å¾®ä¿¡å·å·²æ³¨å†Œï¼';
                            authError.classList.remove('hidden');
                        }
                        return;
                    }
                    
                    // æ³¨å†Œæ–°ç”¨æˆ·
                    users[username] = password;
                    
                    // åˆå§‹åŒ–ç”¨æˆ·æ•°æ®
                    if (!globalUserData[username]) {
                        const registerTime = new Date().toLocaleString();
                        globalUserData[username] = {
                            leftCount: 0,
                            recordList: [],
                            userDrawCount: 0,
                            prizePools: [],
                            username: username,
                            lastLoginTime: registerTime,
                            registerTime: registerTime,
                            usedCodes: []
                        };
                        
                        // è·å–ç”¨æˆ·IPåœ°å€ï¼ˆæ·»åŠ è¯¦ç»†é”™è¯¯å¤„ç†ï¼‰
                        try {
                            fetch('https://api.ipify.org?format=json')
                                .then(response => {
                                    if (!response.ok) {
                                        throw new Error('ç½‘ç»œå“åº”å¤±è´¥');
                                    }
                                    return response.json();
                                })
                                .then(data => {
                                    const ipAddress = data.ip;
                                    console.log('ç”¨æˆ·IPåœ°å€:', ipAddress);
                                    globalUserData[username].lastLoginIP = ipAddress;
                                    globalUserData[username].registerIP = ipAddress;
                                })
                                .catch(error => {
                                    console.log('è·å–IPåœ°å€å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:', error.message);
                                })
                                .finally(() => {
                                    // æ— è®ºæ˜¯å¦è·å–åˆ°IPåœ°å€ï¼Œéƒ½ä¿å­˜æ•°æ®
                                    saveUsersToTencentCOS();
                                });
                        } catch (error) {
                            console.log('è·å–IPåœ°å€å¤±è´¥ï¼ˆéå…³é”®é”™è¯¯ï¼‰:', error.message);
                            saveUsersToTencentCOS();
                        }
                    }
                    
                    if (authError) {
                        authError.classList.add('hidden');
                    }
                    
                    // ä¿å­˜åˆ°è…¾è®¯äº‘COS
                    saveUsersToTencentCOS();
                    
                    showTipModal('æˆåŠŸ', 'æ³¨å†ŒæˆåŠŸï¼');
                    
                    // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•
                    if (registerForm) registerForm.classList.add('hidden');
                    if (loginForm) loginForm.classList.remove('hidden');
                });
            }
            
            // æ˜¾ç¤ºæ³¨å†Œè¡¨å•
            if (showRegisterBtn) {
                console.log('ç»‘å®šæ˜¾ç¤ºæ³¨å†Œè¡¨å•æŒ‰é’®äº‹ä»¶...');
                showRegisterBtn.addEventListener('click', function() {
                    if (loginForm) loginForm.classList.add('hidden');
                    if (registerForm) registerForm.classList.remove('hidden');
                    if (authError) authError.classList.add('hidden');
                });
            }
            
            // æ˜¾ç¤ºç™»å½•è¡¨å•
            if (showLoginBtn) {
                console.log('ç»‘å®šæ˜¾ç¤ºç™»å½•è¡¨å•æŒ‰é’®äº‹ä»¶...');
                showLoginBtn.addEventListener('click', function() {
                    if (registerForm) registerForm.classList.add('hidden');
                    if (loginForm) loginForm.classList.remove('hidden');
                    if (authError) authError.classList.add('hidden');
                });
            }
            
            // ç»‘å®šå…‘æ¢ç 
            if (bindCodeBtn) {
                console.log('ç»‘å®šå…‘æ¢ç æŒ‰é’®äº‹ä»¶...');
                bindCodeBtn.addEventListener('click', function() {
                    const code = exchangeCode.value.trim();
                    if (!code) {
                        codeError.style.display = 'block';
                        return;
                    }
                    
                    // éªŒè¯å…‘æ¢ç ï¼ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨äºexchangeCodesDataä¸­ï¼Œæ˜¯å¦å·²ä½¿ç”¨ï¼‰
                    if (exchangeCodesData[code] && !exchangeCodesData[code].used) {
                        // æå–æ¬¡æ•°
                        const times = exchangeCodesData[code].times || 1;
                        
                        // å¢åŠ æŠ½å¥–æ¬¡æ•°
                        leftCount += times;
                        
                        // æ ‡è®°å…‘æ¢ç ä¸ºå·²ä½¿ç”¨
                        exchangeCodesData[code].used = true;
                        exchangeCodesData[code].usedTime = new Date().toLocaleString();
                        exchangeCodesData[code].usedBy = currentUser;
                        
                        // æ ‡è®°å…‘æ¢ç ä¸ºå·²ä½¿ç”¨ï¼ˆæœ¬åœ°ï¼‰
                        if (!usedCodes.includes(code)) {
                            usedCodes.push(code);
                        }
                        
                        // æ›´æ–°ç”¨æˆ·æ•°æ®
                        if (currentUser) {
                            if (!globalUserData[currentUser]) {
                                globalUserData[currentUser] = {
                                    leftCount: 0,
                                    recordList: [],
                                    userDrawCount: 0,
                                    prizePools: [],
                                    usedCodes: [],
                                    username: currentUser
                                };
                            }
                            globalUserData[currentUser].leftCount = leftCount;
                            // å°†ä½¿ç”¨çš„å…‘æ¢ç æ·»åŠ åˆ°ç”¨æˆ·çš„usedCodesæ•°ç»„ä¸­
                            if (!globalUserData[currentUser].usedCodes) {
                                globalUserData[currentUser].usedCodes = [];
                            }
                            if (!globalUserData[currentUser].usedCodes.includes(code)) {
                                globalUserData[currentUser].usedCodes.push(code);
                            }
                        }
                        
                        // ä¿å­˜æ•°æ®åˆ°è…¾è®¯äº‘COS
                        saveUsersToTencentCOS();
                        
                        codeError.style.display = 'none';
                        showTipModal('æˆåŠŸ', `å…‘æ¢ç ç»‘å®šæˆåŠŸï¼è·å¾— ${times} æ¬¡æŠ½å¥–æœºä¼š`);
                        
                        // æ›´æ–°é¡µé¢æ˜¾ç¤º
                        updatePageDisplay();
                    } else {
                        codeError.style.display = 'block';
                    }
                });
            }
            
            // é€€å‡ºç™»å½•
            if (logoutBtn) {
                console.log('ç»‘å®šé€€å‡ºç™»å½•æŒ‰é’®äº‹ä»¶...');
                logoutBtn.addEventListener('click', function() {
                    currentUser = '';
                    localStorage.removeItem(STORAGE_KEYS.currentUser);
                    initPage();
                });
            }
            
            // é€šçŸ¥æŒ‰é’®
            if (notificationBtn) {
                console.log('ç»‘å®šé€šçŸ¥æŒ‰é’®äº‹ä»¶...');
                notificationBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»é€šçŸ¥æŒ‰é’®');
                    showNotificationCenter();
                });
            }
            
            // é€šçŸ¥ä¸­å¿ƒå…³é—­æŒ‰é’®
            if (notificationClose) {
                console.log('ç»‘å®šé€šçŸ¥ä¸­å¿ƒå…³é—­æŒ‰é’®äº‹ä»¶...');
                notificationClose.addEventListener('click', function() {
                    console.log('ç‚¹å‡»é€šçŸ¥ä¸­å¿ƒå…³é—­æŒ‰é’®');
                    if (notificationModal) {
                        notificationModal.classList.remove('show');
                    }
                });
            }
            
            // æ ‡è®°å…¨éƒ¨å·²è¯»æŒ‰é’®
            if (notificationMarkAllRead) {
                console.log('ç»‘å®šæ ‡è®°å…¨éƒ¨å·²è¯»æŒ‰é’®äº‹ä»¶...');
                notificationMarkAllRead.addEventListener('click', function() {
                    console.log('ç‚¹å‡»æ ‡è®°å…¨éƒ¨å·²è¯»æŒ‰é’®');
                    markAllNotificationsAsRead();
                    showNotificationCenter();
                });
            }
            
            // ç®¡ç†å‘˜å…¥å£
            if (adminEnter) {
                console.log('ç»‘å®šç®¡ç†å‘˜å…¥å£æŒ‰é’®äº‹ä»¶...');
                adminEnter.addEventListener('click', function() {
                    console.log('ç‚¹å‡»ç®¡ç†å‘˜å…¥å£æŒ‰é’®');
                    if (authPage) authPage.classList.add('hidden');
                    if (userPage) userPage.classList.add('hidden');
                    if (adminPage) {
                        adminPage.style.display = 'block';
                        console.log('æ˜¾ç¤ºç®¡ç†å‘˜é¡µé¢');
                    }
                });
            }
            
            // ç®¡ç†å‘˜ç™»å½•
            if (adminLoginBtn) {
                console.log('ç»‘å®šç®¡ç†å‘˜ç™»å½•æŒ‰é’®äº‹ä»¶...');
                adminLoginBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»ç®¡ç†å‘˜ç™»å½•æŒ‰é’®');
                    if (adminPwd.value === ADMIN_PWD) {
                        console.log('ç®¡ç†å‘˜å¯†ç æ­£ç¡®');
                        if (adminLogin) adminLogin.style.display = 'none';
                        if (adminMain) adminMain.style.display = 'block';
                        
                        // ç›´æ¥ä»è…¾è®¯äº‘COSåŠ è½½æœ€æ–°æ•°æ®ï¼Œç¡®ä¿è·¨è®¾å¤‡æ•°æ®åŒæ­¥
                        if (window.COS && window.cosConfig) {
                            console.log('ä»è…¾è®¯äº‘COSåŠ è½½æœ€æ–°ç”¨æˆ·æ•°æ®...');
                            const cos = new COS({
                                SecretId: window.cosConfig.SecretId,
                                SecretKey: window.cosConfig.SecretKey,
                                // ç¦ç”¨SDKå†…éƒ¨çš„å¥åº·æ£€æŸ¥ï¼Œå‡å°‘404é”™è¯¯
                                ClientConfig: {
                                    DisableHealthCheck: true
                                }
                            });
                            
                            // åŠ è½½usersæ•°æ®
                            cos.getObject({
                                Bucket: window.cosConfig.Bucket,
                                Region: window.cosConfig.Region,
                                Key: 'users.json'
                            }, (err, data) => {
                                if (err) {
                                    console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                    users = {};
                                } else {
                                    try {
                                        users = JSON.parse(data.Body.toString());
                                        console.log('ç”¨æˆ·è´¦å·æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                                    } catch (e) {
                                        console.log('è§£æç”¨æˆ·è´¦å·æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                        users = {};
                                    }
                                }
                                
                                // åŠ è½½globalUserDataæ•°æ®
                                cos.getObject({
                                    Bucket: window.cosConfig.Bucket,
                                    Region: window.cosConfig.Region,
                                    Key: 'globalUserData.json'
                                }, (err, data) => {
                                    if (err) {
                                        console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                        globalUserData = {};
                                    } else {
                                        try {
                                            globalUserData = JSON.parse(data.Body.toString());
                                            console.log('ç”¨æˆ·è¯¦ç»†æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                                        } catch (e) {
                                            console.log('è§£æç”¨æˆ·è¯¦ç»†æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                            globalUserData = {};
                                        }
                                    }
                                    
                                    // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
                                    renderAllUserRecord();
                                });
                            });
                        } else {
                            // å¦‚æœè…¾è®¯äº‘COSä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®
                            console.log('è…¾è®¯äº‘COSä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                            users = {};
                            globalUserData = {};
                            renderAllUserRecord();
                        }
                        

                    } else {
                        console.log('ç®¡ç†å‘˜å¯†ç é”™è¯¯');
                        if (adminPwdErrorTip) {
                            adminPwdErrorTip.style.display = 'block';
                        }
                    }
                });
            }
            
            // è¿”å›ç”¨æˆ·é¡µ
            if (backBtn) {
                console.log('ç»‘å®šè¿”å›ç”¨æˆ·é¡µæŒ‰é’®äº‹ä»¶...');
                backBtn.addEventListener('click', function() {
                    if (adminPage) adminPage.style.display = 'none';
                    initPage();
                });
            }
            
            // å…³é—­æ¨¡æ€æ¡†
            if (modalClose) {
                console.log('ç»‘å®šå…³é—­æ¨¡æ€æ¡†æŒ‰é’®äº‹ä»¶...');
                modalClose.addEventListener('click', function() {
                    if (tipModal) {
                        tipModal.classList.remove('show');
                    }
                });
            }
            
            // åˆ·æ–°æ•°æ®
            if (refreshDataBtn) {
                console.log('ç»‘å®šåˆ·æ–°æ•°æ®æŒ‰é’®äº‹ä»¶...');
                refreshDataBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»åˆ·æ–°æ•°æ®æŒ‰é’®...');
                    
                    // ç›´æ¥ä»è…¾è®¯äº‘COSåŠ è½½æœ€æ–°æ•°æ®ï¼Œç¡®ä¿è·¨è®¾å¤‡æ•°æ®åŒæ­¥
                    if (window.COS && window.cosConfig) {
                        console.log('ä»è…¾è®¯äº‘COSåŠ è½½æœ€æ–°ç”¨æˆ·æ•°æ®...');
                        const cos = new COS({
                            SecretId: window.cosConfig.SecretId,
                            SecretKey: window.cosConfig.SecretKey,
                            // ç¦ç”¨SDKå†…éƒ¨çš„å¥åº·æ£€æŸ¥ï¼Œå‡å°‘404é”™è¯¯
                            ClientConfig: {
                                DisableHealthCheck: true
                            }
                        });
                        
                        // åŠ è½½usersæ•°æ®
                        cos.getObject({
                            Bucket: window.cosConfig.Bucket,
                            Region: window.cosConfig.Region,
                            Key: 'users.json'
                        }, (err, data) => {
                            if (err) {
                                console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                users = {};
                            } else {
                                try {
                                    users = JSON.parse(data.Body.toString());
                                    console.log('ç”¨æˆ·è´¦å·æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                                } catch (e) {
                                    console.log('è§£æç”¨æˆ·è´¦å·æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                    users = {};
                                }
                            }
                            
                            // åŠ è½½globalUserDataæ•°æ®
                            cos.getObject({
                                Bucket: window.cosConfig.Bucket,
                                Region: window.cosConfig.Region,
                                Key: 'globalUserData.json'
                            }, (err, data) => {
                                if (err) {
                                    console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                    globalUserData = {};
                                } else {
                                    try {
                                        globalUserData = JSON.parse(data.Body.toString());
                                        console.log('ç”¨æˆ·è¯¦ç»†æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                                    } catch (e) {
                                        console.log('è§£æç”¨æˆ·è¯¦ç»†æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                        globalUserData = {};
                                    }
                                }
                                
                                // æ¸²æŸ“ç”¨æˆ·åˆ—è¡¨
                                renderAllUserRecord();
                                showTipModal('æˆåŠŸ', 'æ•°æ®åˆ·æ–°æˆåŠŸï¼');
                            });
                        });
                    } else {
                        // å¦‚æœè…¾è®¯äº‘COSä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®
                        console.log('è…¾è®¯äº‘COSä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                        users = {};
                        globalUserData = {};
                        renderAllUserRecord();
                        showTipModal('æˆåŠŸ', 'æ•°æ®åˆ·æ–°æˆåŠŸï¼');
                    }
                });
            }
            
            // æ¸…ç©ºæ•°æ®
            if (clearAllDataBtn) {
                console.log('ç»‘å®šæ¸…ç©ºæ•°æ®æŒ‰é’®äº‹ä»¶...');
                clearAllDataBtn.addEventListener('click', function() {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                        // é‡ç½®å˜é‡
                        currentUser = '';
                        leftCount = 0;
                        userDrawCount = 0;
                        recordList = [];
                        users = {};
                        usedCodes = [];
                        globalUserData = {};
                        userPrizePools = {};
                        
                        // æ¸…ç©ºSupabaseæ•°æ®
                        clearTencentCOSData();
                        
                        renderAllUserRecord();
                        showTipModal('æˆåŠŸ', 'æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
                    }
                });
            }
            
            // å¯¼å‡ºæ•°æ®
            if (exportBtn) {
                console.log('ç»‘å®šå¯¼å‡ºæ•°æ®æŒ‰é’®äº‹ä»¶...');
                exportBtn.addEventListener('click', function() {
                    exportData();
                });
            }
            
            // å…‘æ¢ç ç®¡ç†
            if (codeManageBtn) {
                console.log('ç»‘å®šå…‘æ¢ç ç®¡ç†æŒ‰é’®äº‹ä»¶...');
                codeManageBtn.addEventListener('click', function() {
                    const codeManageModal = document.getElementById('codeManageModal');
                    if (codeManageModal) {
                        codeManageModal.classList.add('show');
                    }
                });
            }
            
            // æ·»åŠ ä¸­å¥–è®°å½•
            if (addPrizeBtn) {
                console.log('ç»‘å®šæ·»åŠ ä¸­å¥–è®°å½•æŒ‰é’®äº‹ä»¶...');
                addPrizeBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»æ·»åŠ ä¸­å¥–è®°å½•æŒ‰é’®');
                    const addPrizeModal = document.getElementById('addPrizeModal');
                    if (addPrizeModal) {
                        // è®¾ç½®é»˜è®¤æ—¶é—´
                        const addPrizeTime = document.getElementById('addPrizeTime');
                        if (addPrizeTime) {
                            addPrizeTime.value = new Date().toISOString().slice(0, 16);
                        }
                        addPrizeModal.classList.add('show');
                    }
                });
            }
            
            // æ·»åŠ ä¸­å¥–è®°å½•å–æ¶ˆæŒ‰é’®
            const addPrizeCancel = document.getElementById('addPrizeCancel');
            if (addPrizeCancel) {
                addPrizeCancel.addEventListener('click', function() {
                    console.log('ç‚¹å‡»æ·»åŠ ä¸­å¥–è®°å½•å–æ¶ˆæŒ‰é’®');
                    const addPrizeModal = document.getElementById('addPrizeModal');
                    if (addPrizeModal) {
                        addPrizeModal.classList.remove('show');
                    }
                });
            }
            
            // æ·»åŠ ä¸­å¥–è®°å½•æäº¤æŒ‰é’®
            const addPrizeSubmit = document.getElementById('addPrizeSubmit');
            if (addPrizeSubmit) {
                addPrizeSubmit.addEventListener('click', function() {
                    console.log('ç‚¹å‡»æ·»åŠ ä¸­å¥–è®°å½•æäº¤æŒ‰é’®');
                    addUserPrize();
                });
            }
            
            // å…³é—­å…‘æ¢ç ç®¡ç†
            if (codeManageCancel) {
                console.log('ç»‘å®šå…³é—­å…‘æ¢ç ç®¡ç†æŒ‰é’®äº‹ä»¶...');
                codeManageCancel.addEventListener('click', function() {
                    const codeManageModal = document.getElementById('codeManageModal');
                    if (codeManageModal) {
                        codeManageModal.classList.remove('show');
                    }
                });
            }
            
            // ç”Ÿæˆå…‘æ¢ç 
            if (generateCodeBtn) {
                console.log('ç»‘å®šç”Ÿæˆå…‘æ¢ç æŒ‰é’®äº‹ä»¶...');
                generateCodeBtn.addEventListener('click', function() {
                    const times = parseInt(codeDrawTimes.value) || 1;
                    const count = parseInt(codeGenerateCount.value) || 1;
                    const codes = [];
                    const CODE_PASSWORD = 'laide';
                    
                    // ç”ŸæˆåŒ…å«å¯†ç çš„å…‘æ¢ç 
                    function generateRandomCode(times) {
                        // ç”Ÿæˆå­—ç¬¦é›†ï¼ˆå¤§å†™å­—æ¯å’Œæ•°å­—ç»„åˆï¼‰
                        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                        
                        // ç”Ÿæˆå‰é¢çš„ä»»æ„å­—ç¬¦ï¼ˆ3-5ä½ï¼‰
                        let prefix = '';
                        const prefixLength = Math.floor(Math.random() * 3) + 3; // 3-5ä½
                        for (let i = 0; i < prefixLength; i++) {
                            prefix += chars.charAt(Math.floor(Math.random() * chars.length));
                        }
                        
                        // ç”Ÿæˆåé¢çš„ä»»æ„å­—ç¬¦ï¼ˆ3-5ä½ï¼‰
                        let suffix = '';
                        const suffixLength = Math.floor(Math.random() * 3) + 3; // 3-5ä½
                        for (let i = 0; i < suffixLength; i++) {
                            suffix += chars.charAt(Math.floor(Math.random() * chars.length));
                        }
                        
                        // ç”Ÿæˆ3ä½é˜²ä¼ªç¬¦
                        let antiFake = '';
                        for (let i = 0; i < 3; i++) {
                            antiFake += chars.charAt(Math.floor(Math.random() * chars.length));
                        }
                        
                        // ç»„åˆæˆå…‘æ¢ç ï¼šä»»æ„å­—ç¬¦+å¯†ç +ä»»æ„å­—ç¬¦-æ¬¡æ•°-é˜²ä¼ªç¬¦
                        return `${prefix}${CODE_PASSWORD}${suffix}-${times}-${antiFake}`;
                    }
                    
                    for (let i = 0; i < count; i++) {
                        const code = generateRandomCode(times);
                        codes.push(code);
                        
                        // ä¿å­˜å…‘æ¢ç åˆ°exchangeCodesData
                        exchangeCodesData[code] = {
                            times: times,
                            used: false,
                            generatedTime: new Date().toLocaleString()
                        };
                    }
                    
                    codeResult.textContent = codes.join('\n');
                    
                    // ä¿å­˜å…‘æ¢ç æ•°æ®åˆ°è…¾è®¯äº‘COS
                    saveUsersToTencentCOS();
                    
                    showTipModal('æˆåŠŸ', `ç”Ÿæˆäº† ${count} ä¸ªå…‘æ¢ç ï¼`);
                });
            }
            
            // å¤åˆ¶å…‘æ¢ç 
            if (copyCodesBtn) {
                console.log('ç»‘å®šå¤åˆ¶å…‘æ¢ç æŒ‰é’®äº‹ä»¶...');
                copyCodesBtn.addEventListener('click', function() {
                    navigator.clipboard.writeText(codeResult.textContent).then(function() {
                        showTipModal('æˆåŠŸ', 'å…‘æ¢ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    }, function() {
                        showTipModal('é”™è¯¯', 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ï¼');
                    });
                });
            }
            
            console.log('äº‹ä»¶ç»‘å®šåˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUserData() {
            console.log('å¼€å§‹åŠ è½½ç”¨æˆ·æ•°æ®...');
            
            if (currentUser && globalUserData[currentUser]) {
                // ä»å…¨å±€ç”¨æˆ·æ•°æ®ä¸­åŠ è½½
                leftCount = globalUserData[currentUser].leftCount || 0;
                recordList = globalUserData[currentUser].recordList || [];
                userDrawCount = globalUserData[currentUser].userDrawCount || 0;
                
                console.log('åŠ è½½ç”¨æˆ·æ•°æ®:', { leftCount, userDrawCount, recordListLength: recordList.length });
            } else {
                // å¦‚æœç”¨æˆ·æ•°æ®ä¸å­˜åœ¨ï¼Œé‡ç½®ä¸ºé»˜è®¤å€¼
                leftCount = 0;
                recordList = [];
                userDrawCount = 0;
                console.log('ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å€¼');
            }
            
            console.log('ç”¨æˆ·æ•°æ®åŠ è½½å®Œæˆï¼');
        }
        
        // æ›´æ–°é¡µé¢æ˜¾ç¤º
        function updatePageDisplay() {
            console.log('å¼€å§‹æ›´æ–°é¡µé¢æ˜¾ç¤º...');
            
            if (leftCountSpan) {
                leftCountSpan.textContent = leftCount;
            }
            
            if (countTip) {
                if (leftCount > 0) {
                    countTip.classList.remove('hidden');
                } else {
                    countTip.classList.add('hidden');
                }
            }
            
            if (scratchContainer) {
                if (leftCount > 0) {
                    scratchContainer.classList.remove('hidden');
                    // é‡æ–°è°ƒæ•´ç”»å¸ƒå°ºå¯¸
                    if (window.resetScratch) {
                        window.resetScratch();
                    }
                } else {
                    scratchContainer.classList.add('hidden');
                }
            }
            
            if (recordContainer) {
                if (recordList.length > 0) {
                    recordContainer.classList.remove('hidden');
                    renderUserRecord();
                } else {
                    recordContainer.classList.add('hidden');
                }
            }
            
            console.log('é¡µé¢æ˜¾ç¤ºæ›´æ–°å®Œæˆï¼');
        }
        
        // æ¸²æŸ“ç”¨æˆ·ä¸­å¥–è®°å½•
        function renderUserRecord() {
            console.log('å¼€å§‹æ¸²æŸ“ç”¨æˆ·ä¸­å¥–è®°å½•...');
            
            if (recordListEl) {
                // è®¡ç®—ä¸­å¥–ç»Ÿè®¡
                const totalWins = recordList.length;
                const verifiedCount = recordList.filter(r => r.verified).length;
                const cashCount = recordList.filter(r => r.prize.includes('ç°é‡‘')).length;
                const couponCount = recordList.filter(r => r.prize.includes('ä»£é‡‘åˆ¸')).length;
                const shoeCount = recordList.filter(r => r.prize.includes('é‹å­')).length;
                
                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                recordListEl.innerHTML = `
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; text-align: center;">
                        <div style="font-weight: bold; margin-bottom: 10px;">ä¸­å¥–ç»Ÿè®¡</div>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <div>æ€»ä¸­å¥–æ¬¡æ•°: <span style="color: #17a2b8; font-weight: bold;">${totalWins}</span></div>
                            <div>å·²æ ¸éªŒæ¬¡æ•°: <span style="color: #28a745; font-weight: bold;">${verifiedCount}</span></div>
                            <div>ç°é‡‘çº¢åŒ…: <span style="color: #ffc107; font-weight: bold;">${cashCount}</span></div>
                            <div>ä»£é‡‘åˆ¸: <span style="color: #198754; font-weight: bold;">${couponCount}</span></div>
                            <div>é‹å­: <span style="color: #0d6efd; font-weight: bold;">${shoeCount}</span></div>
                            <div>æœªæ ¸éªŒ: <span style="color: #dc3545; font-weight: bold;">${totalWins - verifiedCount}</span></div>
                        </div>
                    </div>
                `;
                
                // æ˜¾ç¤ºä¸­å¥–è®°å½•
                if (recordList.length === 0) {
                    recordListEl.innerHTML += '<div style="text-align: center; color: #666; padding: 20px;">æš‚æ— ä¸­å¥–è®°å½•</div>';
                } else {
                    recordList.forEach((record, index) => {
                        const recordItem = document.createElement('div');
                        recordItem.className = 'record-item';
                        recordItem.style.borderLeft = `4px solid ${record.verified ? '#28a745' : '#dc3545'}`;
                        recordItem.innerHTML = `
                            <div style="font-weight: bold; margin-bottom: 5px;">ç¬¬ ${recordList.length - index} æ¬¡ä¸­å¥–</div>
                            <div style="font-size: 16px; margin-bottom: 5px;">ğŸ‰ ${record.prize}</div>
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">æ—¶é—´: ${record.time}</div>
                            <div style="font-size: 14px; ${record.verified ? 'color: #28a745;' : 'color: #dc3545;'}">
                                ${record.verified ? 'âœ“ å·²æ ¸éªŒ' : 'âœ— æœªæ ¸éªŒ'}
                            </div>
                            <div style="margin-top: 8px; font-size: 12px; color: #999;">
                                ${getPrizeType(record.prize)}
                            </div>
                        `;
                        recordListEl.appendChild(recordItem);
                    });
                }
            }
            
            console.log('ç”¨æˆ·ä¸­å¥–è®°å½•æ¸²æŸ“å®Œæˆï¼');
        }
        
        // è·å–å¥–å“ç±»å‹
        function getPrizeType(prize) {
            if (prize.includes('ç°é‡‘')) {
                return 'ç±»å‹: ç°é‡‘çº¢åŒ…';
            } else if (prize.includes('ä»£é‡‘åˆ¸')) {
                return 'ç±»å‹: ä»£é‡‘åˆ¸';
            } else if (prize.includes('é‹å­')) {
                return 'ç±»å‹: å®ç‰©å¥–å“';
            } else {
                return 'ç±»å‹: å…¶ä»–å¥–å“';
            }
        }
        
        // æ¸²æŸ“æ‰€æœ‰ç”¨æˆ·è®°å½•ï¼ˆç®¡ç†å‘˜åå°ï¼‰
        function renderAllUserRecord() {
            console.log('å¼€å§‹æ¸²æŸ“æ‰€æœ‰ç”¨æˆ·è®°å½•...');
            
            try {
                if (userList) {
                    userList.innerHTML = '';
                    
                    // å¯¹ç”¨æˆ·æ•°æ®å»é‡
                    const uniqueUsers = {};
                    
                    // å¤„ç†å…¨å±€ç”¨æˆ·æ•°æ®
                    if (globalUserData && typeof globalUserData === 'object') {
                        Object.keys(globalUserData).forEach(key => {
                            try {
                                const userData = globalUserData[key];
                                if (userData && userData.username) {
                                    uniqueUsers[userData.username] = userData;
                                }
                            } catch (error) {
                                console.error('å¤„ç†å…¨å±€ç”¨æˆ·æ•°æ®å‡ºé”™:', error);
                            }
                        });
                    }
                    
                    // åŒæ—¶æ·»åŠ ç›´æ¥ä»¥å¾®ä¿¡å·ä¸ºé”®çš„æ•°æ®
                    if (users && typeof users === 'object') {
                        Object.keys(users).forEach(username => {
                            try {
                                if (!uniqueUsers[username]) {
                                    uniqueUsers[username] = {
                                        leftCount: 0,
                                        recordList: [],
                                        userDrawCount: 0,
                                        prizePools: [],
                                        username: username
                                    };
                                }
                            } catch (error) {
                                console.error('å¤„ç†ç”¨æˆ·æ•°æ®å‡ºé”™:', error);
                            }
                        });
                    }
                    
                    // ç»Ÿè®¡æ•°æ®
                    const totalUsers = Object.keys(uniqueUsers).length;
                    let totalDraws = 0;
                    let totalShoeUsers = 0;
                    
                    Object.values(uniqueUsers).forEach(userData => {
                        try {
                            totalDraws += userData.userDrawCount || 0;
                            if (userData.recordList && Array.isArray(userData.recordList)) {
                                const hasShoe = userData.recordList.some(record => record && record.prize && record.prize.includes('é‹å­'));
                                if (hasShoe) {
                                    totalShoeUsers++;
                                }
                            }
                        } catch (error) {
                            console.error('ç»Ÿè®¡ç”¨æˆ·æ•°æ®å‡ºé”™:', error);
                        }
                    });
                    
                    // æ›´æ–°ç»Ÿè®¡æ•°æ®
                    try {
                        if (totalUserNum) totalUserNum.textContent = totalUsers;
                        if (totalDrawNum) totalDrawNum.textContent = totalDraws;
                        if (totalShoeUser) totalShoeUser.textContent = totalShoeUsers;
                        if (totalUsedCode) totalUsedCode.textContent = usedCodes ? usedCodes.length : 0;
                    } catch (error) {
                        console.error('æ›´æ–°ç»Ÿè®¡æ•°æ®å‡ºé”™:', error);
                    }
                    
                    console.log('ç»Ÿè®¡æ•°æ®:', { totalUsers, totalDraws, totalShoeUsers, usedCodesLength: usedCodes ? usedCodes.length : 0 });
                    
                    // æ¸²æŸ“ç”¨æˆ·å¡ç‰‡
                    Object.values(uniqueUsers).forEach(userData => {
                        try {
                            const userCard = document.createElement('div');
                            userCard.className = 'user-card';
                            
                            let prizeList = '';
                            if (userData.recordList && Array.isArray(userData.recordList)) {
                                prizeList = userData.recordList.map((record, index) => {
                                    if (!record) return '';
                                    return `
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="flex: 1;">
                                                <span>${record.prize || ''}</span>
                                                <span style="margin-left: 10px;">${record.time || ''}</span>
                                            </div>
                                            <div style="display: flex; align-items: center; gap: 10px;">
                                                ${record.verified ? '<span style="color: #28a745;">âœ“ å·²æ ¸éªŒ</span>' : '<span style="color: #dc3545;">âœ— æœªæ ¸éªŒ</span>'}
                                                ${!record.verified ? `<button class="btn btn-sm" onclick="verifySinglePrize('${userData.username}', ${index})">æ ¸éªŒ</button>` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('');
                            }
                            
                            // ç”Ÿæˆå…‘æ¢ç è®°å½•
                            let usedCodesList = '';
                            if (userData.usedCodes && Array.isArray(userData.usedCodes) && userData.usedCodes.length > 0) {
                                usedCodesList = userData.usedCodes.map(code => {
                                    // æå–å…‘æ¢ç ä¸­çš„æ¬¡æ•°
                                    const parts = code.split('-');
                                    const times = parts.length >= 2 ? parts[1] : '1';
                                    return `
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span>${code}</span>
                                            <span>è·å¾— ${times} æ¬¡</span>
                                        </div>
                                    `;
                                }).join('');
                            }
                            
                            userCard.innerHTML = `
                                <h4>
                                    ${userData.username || 'æœªçŸ¥ç”¨æˆ·'}
                                    <span>å‰©ä½™æ¬¡æ•°: ${userData.leftCount || 0}</span>
                                </h4>
                                <div class="user-info">
                                    <div>æ€»æŠ½å¥–æ¬¡æ•°: <span>${userData.userDrawCount || 0}</span></div>
                                    <div>ä¸­å¥–æ¬¡æ•°: <span>${userData.recordList && Array.isArray(userData.recordList) ? userData.recordList.length : 0}</span></div>
                                </div>
                                <div class="prize-detail">
                                    <h5>ä¸­å¥–è®°å½•</h5>
                                    <div class="user-prize-list">
                                        ${prizeList || '<div>æš‚æ— ä¸­å¥–è®°å½•</div>'}
                                    </div>
                                </div>
                                <div class="prize-detail" style="margin-top: 15px;">
                                    <h5>å…‘æ¢ç è®°å½•</h5>
                                    <div class="user-prize-list">
                                        ${usedCodesList || '<div>æš‚æ— å…‘æ¢ç è®°å½•</div>'}
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    <button class="btn btn-sm" onclick="addDrawTimes('${userData.username || ''}')">å……å€¼æ¬¡æ•°</button>
                                    <button class="btn btn-sm btn-info" onclick="verifyUserPrizes('${userData.username || ''}')">æ ¸éªŒå¥–å“</button>
                                    <button class="btn btn-sm btn-danger" onclick="resetUserPassword('${userData.username || ''}')">é‡ç½®å¯†ç </button>
                                </div>
                            `;
                            
                            userList.appendChild(userCard);
                        } catch (error) {
                            console.error('æ¸²æŸ“ç”¨æˆ·å¡ç‰‡å‡ºé”™:', error);
                        }
                    });
                }
                
                console.log('æ‰€æœ‰ç”¨æˆ·è®°å½•æ¸²æŸ“å®Œæˆï¼');
            } catch (error) {
                console.error('æ¸²æŸ“ç®¡ç†é¡µé¢å‡ºé”™:', error);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œé¿å…ç™½å±
                if (userList) {
                    userList.innerHTML = `<div style="padding: 20px; text-align: center; color: #dc3545;">æ¸²æŸ“å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•<br>é”™è¯¯: ${error.message}</div>`;
                }
            }
        }
        
        // å……å€¼æŠ½å¥–æ¬¡æ•°
        window.addDrawTimes = function(username) {
            console.log('å¼€å§‹å……å€¼æŠ½å¥–æ¬¡æ•°:', username);
            
            const times = prompt('è¯·è¾“å…¥è¦å……å€¼çš„æŠ½å¥–æ¬¡æ•°:', '1');
            const numTimes = parseInt(times);
            
            if (numTimes > 0) {
                if (globalUserData[username]) {
                    globalUserData[username].leftCount = (globalUserData[username].leftCount || 0) + numTimes;
                } else {
                    globalUserData[username] = {
                        leftCount: numTimes,
                        recordList: [],
                        userDrawCount: 0,
                        prizePools: [],
                        username: username
                    };
                }
                
                // ä¿å­˜åˆ°è…¾è®¯äº‘COS
                saveUsersToTencentCOS();
                
                renderAllUserRecord();
                showTipModal('æˆåŠŸ', `å·²ä¸ºç”¨æˆ· ${username} å……å€¼ ${numTimes} æ¬¡æŠ½å¥–æœºä¼šï¼`);
            }
            
            console.log('å……å€¼æŠ½å¥–æ¬¡æ•°å®Œæˆï¼');
        };
        
        // æ ¸éªŒç”¨æˆ·å¥–å“ï¼ˆå•ä¸ªï¼‰
        window.verifySinglePrize = function(username, index) {
            console.log('å¼€å§‹æ ¸éªŒå•ä¸ªå¥–å“:', username, index);
            
            if (globalUserData[username] && globalUserData[username].recordList && globalUserData[username].recordList[index]) {
                globalUserData[username].recordList[index].verified = true;
                
                // ä¿å­˜åˆ°è…¾è®¯äº‘COS
                saveUsersToTencentCOS();
                
                // åŒæ­¥åˆ°å½“å‰ç”¨æˆ·æ•°æ®
                if (currentUser === username) {
                    recordList = globalUserData[username].recordList;
                }
                
                renderAllUserRecord();
                showTipModal('æˆåŠŸ', `å·²æ ¸éªŒè¯¥å¥–å“ï¼`);
            }
            
            console.log('å•ä¸ªå¥–å“æ ¸éªŒå®Œæˆï¼');
        };
        
        // æ ¸éªŒç”¨æˆ·å¥–å“ï¼ˆå…¨éƒ¨ï¼‰
        window.verifyUserPrizes = function(username) {
            console.log('å¼€å§‹æ ¸éªŒç”¨æˆ·æ‰€æœ‰å¥–å“:', username);
            
            if (globalUserData[username] && globalUserData[username].recordList) {
                globalUserData[username].recordList.forEach(record => {
                    record.verified = true;
                });
                
                // ä¿å­˜åˆ°Supabase
                saveUsersToTencentCOS();
                
                // åŒæ­¥åˆ°å½“å‰ç”¨æˆ·æ•°æ®
                if (currentUser === username) {
                    recordList = globalUserData[username].recordList;
                }
                
                renderAllUserRecord();
                showTipModal('æˆåŠŸ', `å·²æ ¸éªŒç”¨æˆ· ${username} çš„æ‰€æœ‰å¥–å“ï¼`);
            }
            
            console.log('ç”¨æˆ·æ‰€æœ‰å¥–å“æ ¸éªŒå®Œæˆï¼');
        };
        
        // é‡ç½®ç”¨æˆ·å¯†ç 
        window.resetUserPassword = function(username) {
            console.log('å¼€å§‹é‡ç½®ç”¨æˆ·å¯†ç :', username);
            
            if (!username) {
                showTipModal('é”™è¯¯', 'ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼');
                return;
            }
            
            if (!users[username]) {
                showTipModal('é”™è¯¯', 'è¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            const newPassword = prompt('è¯·è¾“å…¥ä¸ºç”¨æˆ· "' + username + '" è®¾ç½®çš„æ–°å¯†ç :', '');
            
            if (!newPassword) {
                return; // ç”¨æˆ·å–æ¶ˆè¾“å…¥
            }
            
            if (newPassword.length < 6) {
                showTipModal('é”™è¯¯', 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½ï¼');
                return;
            }
            
            // é‡ç½®å¯†ç 
            users[username] = newPassword;
            
            // ä¿å­˜åˆ°è…¾è®¯äº‘COS
            saveUsersToTencentCOS();
            
            showTipModal('æˆåŠŸ', `ç”¨æˆ· "${username}" çš„å¯†ç é‡ç½®æˆåŠŸï¼`);
            
            console.log('ç”¨æˆ·å¯†ç é‡ç½®å®Œæˆ:', username);
        };
        
        // ç”ŸæˆCSVæ ¼å¼æ•°æ®
        function generateCSVData() {
            console.log('å¼€å§‹ç”ŸæˆCSVæ•°æ®...');
            
            // CSVè¡¨å¤´
            let csvContent = 'ç”¨æˆ·å,å‰©ä½™æŠ½å¥–æ¬¡æ•°,æ€»æŠ½å¥–æ¬¡æ•°,ä¸­å¥–æ¬¡æ•°,æœ€åç™»å½•æ—¶é—´,æœ€åç™»å½•IP,æ³¨å†Œæ—¶é—´,æ³¨å†ŒIP\n';
            
            // å¤„ç†æ‰€æœ‰ç”¨æˆ·æ•°æ®
            Object.keys(globalUserData).forEach(username => {
                const userData = globalUserData[username];
                const leftCount = userData.leftCount || 0;
                const userDrawCount = userData.userDrawCount || 0;
                const recordCount = userData.recordList ? userData.recordList.length : 0;
                const lastLoginTime = userData.lastLoginTime || 'æœªçŸ¥';
                const lastLoginIP = userData.lastLoginIP || 'æœªçŸ¥';
                const registerTime = userData.registerTime || 'æœªçŸ¥';
                const registerIP = userData.registerIP || 'æœªçŸ¥';
                
                // æ·»åŠ ç”¨æˆ·æ•°æ®è¡Œ
                csvContent += `"${username}",${leftCount},${userDrawCount},${recordCount},"${lastLoginTime}","${lastLoginIP}","${registerTime}","${registerIP}"\n`;
            });
            
            // æ·»åŠ ä¸­å¥–è®°å½•
            csvContent += '\n=== ä¸­å¥–è®°å½• ===\n';
            csvContent += 'ç”¨æˆ·å,å¥–å“,æ—¶é—´,æ ¸éªŒçŠ¶æ€\n';
            
            Object.keys(globalUserData).forEach(username => {
                const userData = globalUserData[username];
                if (userData.recordList && userData.recordList.length > 0) {
                    userData.recordList.forEach(record => {
                        const prize = record.prize || '';
                        const time = record.time || '';
                        const verified = record.verified ? 'å·²æ ¸éªŒ' : 'æœªæ ¸éªŒ';
                        
                        // æ·»åŠ ä¸­å¥–è®°å½•è¡Œ
                        csvContent += `"${username}","${prize}","${time}","${verified}"\n`;
                    });
                }
            });
            
            console.log('CSVæ•°æ®ç”Ÿæˆå®Œæˆï¼');
            return csvContent;
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            console.log('å¼€å§‹å¯¼å‡ºæ•°æ®...');
            
            // æ˜¾ç¤ºå¯¼å‡ºé€‰é¡¹
            const exportOption = confirm('è¯·é€‰æ‹©å¯¼å‡ºæ ¼å¼ï¼š\nç¡®å®š - CSVæ ¼å¼ï¼ˆExcelå¯æ‰“å¼€ï¼‰\nå–æ¶ˆ - JSONæ ¼å¼ï¼ˆåŸå§‹æ•°æ®ï¼‰');
            
            if (exportOption) {
                // å¯¼å‡ºCSVæ ¼å¼
                const csvContent = generateCSVData();
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `åˆ®åˆ®ä¹æ•°æ®_${new Date().toISOString().slice(0,10)}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                
                console.log('CSVæ•°æ®å¯¼å‡ºå®Œæˆï¼');
                showTipModal('æˆåŠŸ', 'CSVæ•°æ®å¯¼å‡ºå®Œæˆï¼');
            } else {
                // å¯¼å‡ºJSONæ ¼å¼
                const data = {
                    users: users,
                    globalUserData: globalUserData,
                    usedCodes: usedCodes
                };
                
                const jsonStr = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `åˆ®åˆ®ä¹æ•°æ®_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                console.log('JSONæ•°æ®å¯¼å‡ºå®Œæˆï¼');
                showTipModal('æˆåŠŸ', 'JSONæ•°æ®å¯¼å‡ºå®Œæˆï¼');
            }
        }
        
        // æ·»åŠ ç”¨æˆ·ä¸­å¥–è®°å½•
        function addUserPrize() {
            console.log('å¼€å§‹æ·»åŠ ç”¨æˆ·ä¸­å¥–è®°å½•...');
            
            const addPrizeUsername = document.getElementById('addPrizeUsername');
            const addPrizeType = document.getElementById('addPrizeType');
            const addPrizeTime = document.getElementById('addPrizeTime');
            const addPrizeVerified = document.getElementById('addPrizeVerified');
            
            const username = addPrizeUsername.value.trim();
            const prize = addPrizeType.value;
            const time = addPrizeTime.value;
            const verified = addPrizeVerified.value === 'true';
            
            // éªŒè¯è¾“å…¥
            if (!username) {
                showTipModal('é”™è¯¯', 'è¯·è¾“å…¥ç”¨æˆ·åï¼');
                return;
            }
            
            if (!prize) {
                showTipModal('é”™è¯¯', 'è¯·é€‰æ‹©å¥–å“ï¼');
                return;
            }
            
            if (!time) {
                showTipModal('é”™è¯¯', 'è¯·é€‰æ‹©æ—¶é—´ï¼');
                return;
            }
            
            // éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨
            if (!users[username]) {
                showTipModal('é”™è¯¯', 'ç”¨æˆ·ä¸å­˜åœ¨ï¼');
                return;
            }
            
            // ç¡®ä¿ç”¨æˆ·æ•°æ®å­˜åœ¨
            if (!globalUserData[username]) {
                globalUserData[username] = {
                    leftCount: 0,
                    recordList: [],
                    userDrawCount: 0,
                    prizePools: [],
                    usedCodes: [],
                    lastLoginTime: new Date().toLocaleString()
                };
            }
            
            // æ·»åŠ ä¸­å¥–è®°å½•
            const record = {
                prize: prize,
                time: new Date(time).toLocaleString(),
                verified: verified
            };
            
            globalUserData[username].recordList.unshift(record);
            globalUserData[username].userDrawCount++;
            
            // ä¿å­˜æ•°æ®
            saveUsersToTencentCOS();
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showTipModal('æˆåŠŸ', `å·²æˆåŠŸä¸ºç”¨æˆ· ${username} æ·»åŠ ä¸­å¥–è®°å½•ï¼`);
            
            // å…³é—­æ¨¡æ€æ¡†
            const addPrizeModal = document.getElementById('addPrizeModal');
            if (addPrizeModal) {
                addPrizeModal.classList.remove('show');
            }
            
            // æ¸…ç©ºè¾“å…¥
            addPrizeUsername.value = '';
            addPrizeTime.value = '';
            
            // åˆ·æ–°ç®¡ç†å‘˜åå°çš„ç”¨æˆ·åˆ—è¡¨
            renderAllUserRecord();
            
            console.log('ç”¨æˆ·ä¸­å¥–è®°å½•æ·»åŠ å®Œæˆï¼');
        }
        
        // ç”Ÿæˆéšæœºå¥–å“
        function getRandomPrize() {
            console.log('å¼€å§‹ç”Ÿæˆéšæœºå¥–å“ï¼Œå½“å‰æ€»æŠ½å¥–æ¬¡æ•°:', userDrawCount + 1);
            
            // å®ç°å‘¨æœŸé€»è¾‘ï¼šæ¯10æ¬¡æŠ½å¥–ä¸ºä¸€ä¸ªå‘¨æœŸ
            const cycleCount = (userDrawCount % 10);
            console.log('å½“å‰å‘¨æœŸå†…æŠ½å¥–æ¬¡æ•°:', cycleCount + 1);
            
            // ç¬¬ä¸€æ¬¡æŠ½å¥–ï¼ˆå‘¨æœŸå†…ï¼‰ï¼šè‚¯å®šæ˜¯8.8å…ƒç°é‡‘çº¢åŒ…
            if (cycleCount === 0) {
                console.log('å‘¨æœŸå†…ç¬¬ä¸€æ¬¡æŠ½å¥–ï¼Œå¿…ä¸­8.8å…ƒç°é‡‘çº¢åŒ…');
                return PRIZES.cash88;
            }
            
            // ç¬¬10æ¬¡æŠ½å¥–ï¼ˆå‘¨æœŸå†…ï¼‰ï¼šä¿åº•å‡ºé‹å­
            if (cycleCount === 9) {
                console.log('å‘¨æœŸå†…ç¬¬10æ¬¡æŠ½å¥–ï¼Œä¿åº•å‡ºé‹å­');
                return PRIZES.shoe;
            }
            
            // ç¬¬2-9æ¬¡æŠ½å¥–ï¼ˆå‘¨æœŸå†…ï¼‰ï¼šéšæœºå‡ºç°ä¸¤æ¬¡6.6å…ƒï¼Œå…¶ä½™æ˜¯20å’Œ25å…ƒä»£é‡‘åˆ¸
            if (cycleCount >= 1 && cycleCount <= 8) {
                console.log('å‘¨æœŸå†…ç¬¬2-9æ¬¡æŠ½å¥–ï¼Œéšæœºç”Ÿæˆå¥–å“');
                
                // è®¡ç®—å½“å‰å‘¨æœŸçš„èµ·å§‹ç´¢å¼•
                const cycleStartIndex = Math.floor(userDrawCount / 10) * 10;
                console.log('å½“å‰å‘¨æœŸèµ·å§‹ç´¢å¼•:', cycleStartIndex);
                
                // æ£€æŸ¥å½“å‰å‘¨æœŸå†…æ˜¯å¦å·²ç»ä¸­è¿‡6.6å…ƒ
                let sixSixCount = 0;
                if (recordList && Array.isArray(recordList)) {
                    // åªæ£€æŸ¥å½“å‰å‘¨æœŸå†…çš„ä¸­å¥–è®°å½•
                    const currentCycleRecords = recordList.slice(cycleStartIndex);
                    sixSixCount = currentCycleRecords.filter(record => record && record.prize === PRIZES.cash66).length;
                }
                
                console.log('å½“å‰å‘¨æœŸå†…å·²ä¸­6.6å…ƒæ¬¡æ•°:', sixSixCount);
                
                // å¦‚æœè¿˜æ²¡ä¸­è¿‡ä¸¤æ¬¡6.6å…ƒï¼Œæœ‰50%æ¦‚ç‡ä¸­6.6å…ƒï¼ˆæé«˜æ¦‚ç‡ç¡®ä¿èƒ½ä¸­ä¸¤æ¬¡ï¼‰
                if (sixSixCount < 2 && Math.random() < 0.5) {
                    console.log('éšæœºä¸­6.6å…ƒç°é‡‘çº¢åŒ…');
                    return PRIZES.cash66;
                } else {
                    // å¦åˆ™éšæœºä¸­20æˆ–25å…ƒä»£é‡‘åˆ¸ï¼ˆå„50%æ¦‚ç‡ï¼‰
                    const couponType = Math.random() < 0.5 ? PRIZES.coupon20 : PRIZES.coupon25;
                    console.log('éšæœºä¸­ä»£é‡‘åˆ¸:', couponType);
                    return couponType;
                }
            }
            
            // é»˜è®¤è¿”å›ä¸€ä¸ªå¥–å“
            console.log('é»˜è®¤ä¸­å¥–ç»“æœ:', PRIZES.coupon20);
            return PRIZES.coupon20;
        }
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®
        function saveUserData() {
            console.log('å¼€å§‹ä¿å­˜ç”¨æˆ·æ•°æ®...');
            
            if (currentUser) {
                // æ›´æ–°å…¨å±€ç”¨æˆ·æ•°æ®
                if (!globalUserData[currentUser]) {
                    globalUserData[currentUser] = {
                        leftCount: 0,
                        recordList: [],
                        userDrawCount: 0,
                        prizePools: [],
                        usedCodes: [],
                        username: currentUser
                    };
                }
                globalUserData[currentUser].leftCount = leftCount;
                globalUserData[currentUser].recordList = recordList;
                globalUserData[currentUser].userDrawCount = userDrawCount;
                // ç¡®ä¿usedCodeså­—æ®µå­˜åœ¨
                if (!globalUserData[currentUser].usedCodes) {
                    globalUserData[currentUser].usedCodes = [];
                }
                
                // ç›´æ¥ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('lottery_users', JSON.stringify(users));
                localStorage.setItem('lottery_globalUserData', JSON.stringify(globalUserData));
                console.log('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                
                // å°è¯•ä¿å­˜åˆ°è…¾è®¯äº‘COS
                if (window.COS && window.cosConfig) {
                    try {
                        const cos = new COS({
                            SecretId: window.cosConfig.SecretId,
                            SecretKey: window.cosConfig.SecretKey
                        });
                        
                        // ä¿å­˜usersæ•°æ®
                        cos.putObject({
                            Bucket: window.cosConfig.Bucket,
                            Region: window.cosConfig.Region,
                            Key: 'users.json',
                            Body: JSON.stringify(users)
                        }, (err, data) => {
                            if (err) {
                                console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                            } else {
                                console.log('ä¿å­˜ç”¨æˆ·è´¦å·æ•°æ®åˆ°è…¾è®¯äº‘COSæˆåŠŸ');
                            }
                        });
                        
                        // ä¿å­˜globalUserDataæ•°æ®
                        cos.putObject({
                            Bucket: window.cosConfig.Bucket,
                            Region: window.cosConfig.Region,
                            Key: 'globalUserData.json',
                            Body: JSON.stringify(globalUserData)
                        }, (err, data) => {
                            if (err) {
                                console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                            } else {
                                console.log('ä¿å­˜ç”¨æˆ·è¯¦ç»†æ•°æ®åˆ°è…¾è®¯äº‘COSæˆåŠŸ');
                            }
                        });
                    } catch (error) {
                        console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                    }
                } else {
                    console.log('è…¾è®¯äº‘COS SDKæœªåŠ è½½æˆ–é…ç½®æœªè®¾ç½®ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
                }
                
                console.log('ç”¨æˆ·æ•°æ®ä¿å­˜å®Œæˆ:', { leftCount, userDrawCount, recordListLength: recordList.length });
            }
        }
        
        // ä»è…¾è®¯äº‘COSåŠ è½½æ‰€æœ‰æ•°æ®
        function loadAllDataFromTencentCOS() {
            console.log('å¼€å§‹ä»è…¾è®¯äº‘COSåŠ è½½æ‰€æœ‰æ•°æ®...');
            
            // ç›´æ¥ä»è…¾è®¯äº‘COSåŠ è½½æ•°æ®ï¼Œç¡®ä¿è·¨è®¾å¤‡æ•°æ®åŒæ­¥
            if (window.COS && window.cosConfig) {
                try {
                    const cos = new COS({
                        SecretId: window.cosConfig.SecretId,
                        SecretKey: window.cosConfig.SecretKey,
                        // ç¦ç”¨SDKå†…éƒ¨çš„å¥åº·æ£€æŸ¥ï¼Œå‡å°‘404é”™è¯¯
                        ClientConfig: {
                            DisableHealthCheck: true
                        }
                    });
                    
                    // åŠ è½½usersæ•°æ®
                    cos.getObject({
                        Bucket: window.cosConfig.Bucket,
                        Region: window.cosConfig.Region,
                        Key: 'users.json'
                    }, (err, data) => {
                        if (err) {
                            console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                            users = {};
                        } else {
                            try {
                                users = JSON.parse(data.Body.toString());
                                console.log('ç”¨æˆ·è´¦å·æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                            } catch (e) {
                                console.log('è§£æç”¨æˆ·è´¦å·æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                users = {};
                            }
                        }
                        
                        // åŠ è½½globalUserDataæ•°æ®
                        cos.getObject({
                            Bucket: window.cosConfig.Bucket,
                            Region: window.cosConfig.Region,
                            Key: 'globalUserData.json'
                        }, (err, data) => {
                            if (err) {
                                console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                globalUserData = {};
                            } else {
                                try {
                                    globalUserData = JSON.parse(data.Body.toString());
                                    console.log('ç”¨æˆ·è¯¦ç»†æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                                } catch (e) {
                                    console.log('è§£æç”¨æˆ·è¯¦ç»†æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                    globalUserData = {};
                                }
                            }
                            
                            // åŠ è½½exchangeCodesDataæ•°æ®
                            cos.getObject({
                                Bucket: window.cosConfig.Bucket,
                                Region: window.cosConfig.Region,
                                Key: 'exchangeCodesData.json'
                            }, (err, data) => {
                                if (err) {
                                    console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                    exchangeCodesData = {};
                                } else {
                                    try {
                                        exchangeCodesData = JSON.parse(data.Body.toString());
                                        console.log('å…‘æ¢ç æ•°æ®å·²ä»è…¾è®¯äº‘COSåŠ è½½');
                                    } catch (e) {
                                        console.log('è§£æå…‘æ¢ç æ•°æ®å¤±è´¥ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                                        exchangeCodesData = {};
                                    }
                                }
                                
                                console.log('ä»è…¾è®¯äº‘COSåŠ è½½æ•°æ®å®Œæˆ:', { 
                                    users: Object.keys(users).length, 
                                    globalUserData: Object.keys(globalUserData).length,
                                    exchangeCodesData: Object.keys(exchangeCodesData).length 
                                });
                            });
                        });
                    });
                } catch (error) {
                    console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                    users = {};
                    globalUserData = {};
                    console.log('åˆå§‹åŒ–ç©ºæ•°æ®:', { users: Object.keys(users).length, globalUserData: Object.keys(globalUserData).length });
                }
            } else {
                console.log('è…¾è®¯äº‘COS SDKæœªåŠ è½½æˆ–é…ç½®æœªè®¾ç½®ï¼Œåˆå§‹åŒ–ç©ºæ•°æ®');
                users = {};
                globalUserData = {};
                console.log('åˆå§‹åŒ–ç©ºæ•°æ®:', { users: Object.keys(users).length, globalUserData: Object.keys(globalUserData).length });
            }
        }
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°è…¾è®¯äº‘COS
        function saveUsersToTencentCOS() {
            console.log('å¼€å§‹ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°è…¾è®¯äº‘COS...');
            console.log('å‡†å¤‡ä¿å­˜çš„æ•°æ®:', { users: Object.keys(users).length, globalUserData: Object.keys(globalUserData).length });
            
            // ç›´æ¥ä¿å­˜åˆ°è…¾è®¯äº‘COSï¼Œç¡®ä¿è·¨è®¾å¤‡æ•°æ®åŒæ­¥
            if (window.COS && window.cosConfig) {
                try {
                    const cos = new COS({
                        SecretId: window.cosConfig.SecretId,
                        SecretKey: window.cosConfig.SecretKey,
                        // ç¦ç”¨SDKå†…éƒ¨çš„å¥åº·æ£€æŸ¥ï¼Œå‡å°‘404é”™è¯¯
                        ClientConfig: {
                            DisableHealthCheck: true
                        }
                    });
                    
                    // ä¿å­˜usersæ•°æ®
                    cos.putObject({
                        Bucket: window.cosConfig.Bucket,
                        Region: window.cosConfig.Region,
                        Key: 'users.json',
                        Body: JSON.stringify(users)
                    }, (err, data) => {
                        if (err) {
                            console.log('ä¿å­˜ç”¨æˆ·è´¦å·æ•°æ®åˆ°è…¾è®¯äº‘COSå¤±è´¥:', err);
                        } else {
                            console.log('ä¿å­˜ç”¨æˆ·è´¦å·æ•°æ®åˆ°è…¾è®¯äº‘COSæˆåŠŸ');
                        }
                    });
                    
                    // ä¿å­˜globalUserDataæ•°æ®
                    cos.putObject({
                        Bucket: window.cosConfig.Bucket,
                        Region: window.cosConfig.Region,
                        Key: 'globalUserData.json',
                        Body: JSON.stringify(globalUserData)
                    }, (err, data) => {
                        if (err) {
                            console.log('ä¿å­˜ç”¨æˆ·è¯¦ç»†æ•°æ®åˆ°è…¾è®¯äº‘COSå¤±è´¥:', err);
                        } else {
                            console.log('ä¿å­˜ç”¨æˆ·è¯¦ç»†æ•°æ®åˆ°è…¾è®¯äº‘COSæˆåŠŸ');
                        }
                    });
                    
                    // ä¿å­˜exchangeCodesDataæ•°æ®
                    cos.putObject({
                        Bucket: window.cosConfig.Bucket,
                        Region: window.cosConfig.Region,
                        Key: 'exchangeCodesData.json',
                        Body: JSON.stringify(exchangeCodesData)
                    }, (err, data) => {
                        if (err) {
                            console.log('ä¿å­˜å…‘æ¢ç æ•°æ®åˆ°è…¾è®¯äº‘COSå¤±è´¥:', err);
                        } else {
                            console.log('ä¿å­˜å…‘æ¢ç æ•°æ®åˆ°è…¾è®¯äº‘COSæˆåŠŸ');
                            console.log('ç”¨æˆ·æ•°æ®å·²æˆåŠŸåŒæ­¥åˆ°è…¾è®¯äº‘COS');
                        }
                    });
                } catch (error) {
                    console.log('ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°è…¾è®¯äº‘COSå¤±è´¥:', error);
                }
            } else {
                console.log('è…¾è®¯äº‘COS SDKæœªåŠ è½½æˆ–é…ç½®æœªè®¾ç½®');
            }
            
            console.log('ä¿å­˜ç”¨æˆ·æ•°æ®å®Œæˆï¼');
        }
        
        // æ¸…ç©ºè…¾è®¯äº‘COSæ•°æ®
        function clearTencentCOSData() {
            console.log('å¼€å§‹æ¸…ç©ºæ•°æ®...');
            
            // é¦–å…ˆæ¸…ç©ºæœ¬åœ°å­˜å‚¨
            localStorage.removeItem('lottery_users');
            localStorage.removeItem('lottery_globalUserData');
            console.log('æœ¬åœ°å­˜å‚¨æ•°æ®å·²æ¸…ç©º');
            
            // æ£€æµ‹æ˜¯å¦ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ‰“å¼€ï¼ˆä½¿ç”¨æ›´å¯é çš„æ–¹æ³•ï¼‰
            const isLocalFileSystem = window.location.protocol === 'file:' || window.location.origin === 'null';
            if (isLocalFileSystem) {
                console.log('ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæ‰“å¼€ï¼Œæœ¬åœ°æ•°æ®å·²æ¸…ç©º');
                console.log('æ¸…ç©ºæ•°æ®å®Œæˆï¼');
                return;
            }
            
            // å°è¯•æ¸…ç©ºè…¾è®¯äº‘COSæ•°æ®
            if (window.COS && window.cosConfig) {
                try {
                    const cos = new COS({
                        SecretId: window.cosConfig.SecretId,
                        SecretKey: window.cosConfig.SecretKey,
                        // ç¦ç”¨SDKå†…éƒ¨çš„å¥åº·æ£€æŸ¥ï¼Œå‡å°‘404é”™è¯¯
                        ClientConfig: {
                            DisableHealthCheck: true
                        }
                    });
                    
                    // åˆ é™¤usersæ•°æ®
                    cos.deleteObject({
                        Bucket: window.cosConfig.Bucket,
                        Region: window.cosConfig.Region,
                        Key: 'users.json'
                    }, (err, data) => {
                        if (err) {
                            console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œæœ¬åœ°æ•°æ®å·²æ¸…ç©º');
                        } else {
                            console.log('åˆ é™¤ç”¨æˆ·è´¦å·æ•°æ®æˆåŠŸ');
                        }
                    });
                    
                    // åˆ é™¤globalUserDataæ•°æ®
                    cos.deleteObject({
                        Bucket: window.cosConfig.Bucket,
                        Region: window.cosConfig.Region,
                        Key: 'globalUserData.json'
                    }, (err, data) => {
                        if (err) {
                            console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œæœ¬åœ°æ•°æ®å·²æ¸…ç©º');
                        } else {
                            console.log('åˆ é™¤ç”¨æˆ·è¯¦ç»†æ•°æ®æˆåŠŸ');
                            console.log('è…¾è®¯äº‘COSæ•°æ®æ¸…ç©ºæˆåŠŸ');
                        }
                    });
                } catch (error) {
                    console.log('è…¾è®¯äº‘COSæš‚æ—¶ä¸å¯ç”¨ï¼Œæœ¬åœ°æ•°æ®å·²æ¸…ç©º');
                }
            } else {
                console.log('è…¾è®¯äº‘COS SDKæœªåŠ è½½æˆ–é…ç½®æœªè®¾ç½®ï¼Œæœ¬åœ°æ•°æ®å·²æ¸…ç©º');
            }
            
            console.log('æ¸…ç©ºæ•°æ®å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–é¡µé¢
        function initPage() {
            console.log('å¼€å§‹åˆå§‹åŒ–é¡µé¢...');
            
            if (currentUser) {
                // æ˜¾ç¤ºç”¨æˆ·é¡µ
                if (authPage) authPage.classList.add('hidden');
                if (userPage) userPage.classList.remove('hidden');
                if (adminPage) adminPage.style.display = 'none';
                
                // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
                if (currentUserEl) {
                    currentUserEl.textContent = `æ¬¢è¿ï¼Œ${currentUser}`;
                }
                
                // åŠ è½½ç”¨æˆ·æ•°æ®
                loadUserData();
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤º
                updatePageDisplay();
            } else {
                // æ˜¾ç¤ºç™»å½•é¡µ
                if (authPage) authPage.classList.remove('hidden');
                if (userPage) userPage.classList.add('hidden');
                if (adminPage) adminPage.style.display = 'none';
            }
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
        function init() {
            console.log('å¼€å§‹åˆå§‹åŒ–ç³»ç»Ÿ...');
            
            // è·å–DOMå…ƒç´ 
            getDOMElements();
            
            // ä»è…¾è®¯äº‘COSåŠ è½½æ‰€æœ‰æ•°æ®
            loadAllDataFromTencentCOS();
            
            // åˆå§‹åŒ–æ¦‚ç‡é…ç½®
            loadProbabilityConfig();
            
            // åˆå§‹åŒ–éªŒè¯ç 
            initCaptcha();
            
            // åˆå§‹åŒ–å¯†ç é‡ç½®
            initPasswordReset();
            
            // åˆå§‹åŒ–æ»šåŠ¨æ’­æŠ¥
            initTicker();
            
            // åˆå§‹åŒ–æ¦‚ç‡é…ç½®äº‹ä»¶
            initProbabilityConfig();
            
            // åˆå§‹åŒ–åˆ®åˆ®ä¹
            initScratch();
            
            // åˆå§‹åŒ–äº‹ä»¶ç»‘å®šï¼ˆæœ€åè°ƒç”¨ï¼Œç¡®ä¿æ‰€æœ‰å…ƒç´ éƒ½å·²åˆå§‹åŒ–ï¼‰
            bindEvents();
            
            // åˆå§‹åŒ–é¡µé¢
            initPage();
            
            console.log('ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆï¼');
        }
        
        // æ‰§è¡Œåˆå§‹åŒ–
        init();
        
        // ç›‘å¬æ¦‚ç‡è¾“å…¥å˜åŒ–
        const probabilityInputs = document.querySelectorAll('#probabilityForm input[type="number"]');
        probabilityInputs.forEach(input => {
            input.addEventListener('input', calculateTotalProbability);
        });
        
    });
    </script>
</body>
</html>
